{% extends "layout-side-nav.html" %}
{% import "_vars-offices.html" as vars with context %}

{% block title -%}
    {{ office.title | safe if office.title }}
{%- endblock %}

{% block content_main_modifiers -%}
    {{ super() }} content__flush-bottom office
{%- endblock %}

{% block content_main %}

    {% if office.title %}
    <h1>{{ office.title | safe }}</h1>
    {% endif %}

    {% if office.intro.text %}
    <section class="block
                    block__flush-top
                    block__flush-bottom
                    content-l
                    content-l__main
                    content-l__large-gutters">
        {% set intro = office.intro %}
        {% set show_subscription = intro.subscribe_form and intro.govdelivery_code %}
        <div class="content-l_col
                        {% if show_subscription -%}
                            content-l_col-1-2
                        {% else -%}
                            content-l_col-1
                        {%- endif %}
                        ">
            <div class="h3">{{ intro.text | safe }}</div>
        </div>
        {% if show_subscription %}
        <div class="content-l_col
                        content-l_col-1-2
                        content-l_col__before-divider">
            <p class="h3 u-show-on-mobile">Stay informed</p>
            <p class="short-desc">Stay up to date with our email newsletter</p>
            {% import "macros/subscribe.html" as subscribe with context %}
            {{ subscribe.render(intro.govdelivery_code) }}
        </div>
        {% endif %}
    </section>
    {% endif %}

    {% if office.top_story.head %}
    {% set top_story = office.top_story %}
    <section class="block
                    block__padded-top
                    block__border-top">
        {% if top_story.head %}
        <h1 class="h3">{{ top_story.head | safe }}</h1>
        {% endif %}
        <div class="content-l
                    content-l__main
                    content-l__large-gutters">
            {% if top_story.desc %}
            <div class="content-l_col
                        {% if top_story.links -%}
                        content-l_col-1-2
                        {% else -%}
                        content-l_col-1
                        {% endif -%}">
                <p class="short-desc">{{ top_story.desc | safe }}</p>
            </div>
            {% endif %}
            {% if top_story.links %}
            <div class="content-l_col
                        content-l_col-1-2
                        content-l_col__before-divider">
                <ul class="list__links">
                {% for link in top_story.links %}
                <li class="list_item">
                    <a class="jump-link jump-link__right list_link" href="{{ link.url }}">
                        {{link.label}}
                    </a>
                </li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </section>
    {% endif %}

    {% if office.resources %}
    <section class="block
                    block__padded-top
                    block__border-top">
        <h2 class="u-visually-hidden">
            Resources
        </h2>
        {% for resource in office.resources %}
        <div class="media block__sub">
            {% if resource.icon %}
            <div class="media_image-container
                        media_image-container__wide-margin">
                <img class="media_image u-centered-on-mobile"
                     width="150"
                     src="{{resource.icon}}">
            </div>
            {% endif %}
            <div class="media_body">
                {% if resource.title %}
                <h2 class="h3">{{ resource.title | safe }}</h2>
                {% endif %}
                {% if resource.desc %}
                <p class="short-desc">{{ resource.desc | safe }}</p>
                {% endif %}
                {% if resource.link %}
                <a class="jump-link jump-link__right"
                   href="{{ resource.link.url if resource.link }}">
                      {{ resource.link.label }}
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </section>
    {% endif %}

    {% if vars.sub_pages %}
        {% import "macros/sub_pages.html" as sub_pages_macro with context %}
        {{ sub_pages_macro.render( vars.sub_pages, 'Our Work') }}
    {% endif %}

    {% if office.tags %}
    {% import "macros/activity-snippets.html" as activity_snippets with context %}
    {% set activities_feed = activity_snippets.render(office.tags, include_date_flag=true, number_columns=2) %}
    <section class="block
                    block__bg
                    block__flush-sides
                    block__flush-top
                    block__flush-bottom">
        {% include 'templates/activities-feed.html' %}
        <a class="jump-link jump-link__right"
           href="/activity-log/{{ ('?filter_tags=' ~ office.tags | join('&') ) if office.tags }}">
            View all of our activities
        </a>
    </section>
    {% endif %}

    {% include "templates/office-contact.html" %}

{% endblock %}
