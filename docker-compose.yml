version: "3.3"

services:
    mysql:
        image: vsamov/mysql-5.1.73
        ports:
            - "3306:3306"
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: v1
            MYSQL_USER: v1
            MYSQL_PASSWORD: v1
        volumes:
            - "/var/lib/mysql"
    elasticsearch:
        build: 
            context: ./
            dockerfile: ./docker/elasticsearch/Dockerfile
        ports:
            - "9200:9200"
            - "9300:9300"
    gulp:
        build:
            context: .
            dockerfile: Dockerfile-gulp
        working_dir: /src/cfgov-refresh
        environment:
                DJANGO_HTTP_PORT: "8000"
                TEST_HTTP_HOST: "python"
        ports:
            - "3000:3000"
            - "3001:3001"
        command: ['gulp','watch']
        volumes:
                - ./:/src/cfgov-refresh
    python:
        build:
            context: .
            dockerfile: Dockerfile-python
        ports:
            - "8000:8000"
        environment:
            MYSQL_ROOT_PW: root
            MYSQL_HOST: mysql
            MYSQL_NAME: v1
            MYSQL_USER: v1
            MYSQL_PW: v1
            ES_HOST: elasticsearch
        volumes:
                - ./:/src/cfgov-refresh
                - ./develop-apps:/src/develop-apps
        entrypoint: 
                - sh
                - /src/cfgov-refresh/cfgov/entrypoint.sh
        depends_on:
                - mysql
                - elasticsearch                
        working_dir: /src/cfgov-refresh
        env_file: .python_env
        stdin_open: true
        tty: true
