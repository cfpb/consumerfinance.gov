{# ==========================================================================

   share_twitter_url()

   ==========================================================================

   Description:

   Builds a generic Twitter share URL when given nothing.

   Builds a custom Twitter share URL when given:

   options (optional): An object to use for customizing the content of a tweet.
                       If left blank a generic tweet will be generated using the
                       URL of the current page and ` via @CFPB`.

   options.text:       Pre-populated text highlighted in the Tweet.
                       https://dev.twitter.com/web/tweet-button/parameters

   options.related:    A comma-separated list of accounts related to the content
                       of the shared URI.
                       https://dev.twitter.com/web/tweet-button/parameters

   options.language:   Loads text components in the specified language.
                       https://dev.twitter.com/web/tweet-button/parameters

   options.hashtags:   A comma-separated list of hashtags to be appended to
                       default Tweet text.
                       https://dev.twitter.com/web/tweet-button/parameters

   ========================================================================== #}

{% macro share_twitter_url(options) %}
    {% set share_twitter_url = "http://twitter.com/intent/tweet" %}
    {% set share_twitter_url = share_twitter_url + "?url=" + request.url|urlencode %}
    {% set share_twitter_url = share_twitter_url + "&amp;via=CFPB" %}
    {% if options %}
        {# If this is a options object, check for custom fields having been set #}
        {% if options.text %}
            {% set share_twitter_url = share_twitter_url + "&amp;text=" + options.text|urlencode + "%20--" %}
        {% endif %}
        {% if options.related %}
            {% set share_twitter_url = share_twitter_url + "&amp;related=" + options.related %}
        {% endif %}
        {% if options.language %}
            {% set share_twitter_url = share_twitter_url + "&amp;lang=" + options.language %}
        {% endif %}
        {% if options.hashtags %}
            {% set share_twitter_url = share_twitter_url + "&amp;hashtags=" + options.hashtags %}
        {% endif %}
    {% endif %}
    {{ share_twitter_url }}
{% endmacro %}


{# ==========================================================================

   share()

   ==========================================================================

   Description:

   Make share icons when given:

   title:                      The title of the thing to share. Used by the
                               'share via email'.

   hide_heading (optional):    Toggles the heading. Defaults to false.

   twitter_options (optional): See `options` under the `share_twitter_url()`
                               macro.

   share_options (optional):   Object used to modify share markup.

   ==========================================================================

   Example:

       {{ share('Title for email sharing', false,
                { 'text': 'I can write my custom tweet text here' }) }}

   ========================================================================== #}

{% macro share(title, hide_heading=false, twitter_options={}, share_options={}) %}
    {% set text = share_options.text | default('Share this page') %}
    {% set additional_classes = share_options.additional_classes  %}

    <aside {{ ('class=' ~ additional_classes) if additional_classes }}>
        <h1 class="h5 {{'u-visually-hidden' if hide_heading}}">{{ text }}</h1>
        <ul class="post_share list__horizontal">
            <li class="list_item">
                <a class="share-icon"
                   href="http://api.addthis.com/oexchange/0.8/forward/email/offer?url={{ request.url|urlencode }}&amp;title={{ title }}&amp;pubid=ra-4da354ee346886d2"
                   target="_blank">
                    <span class="cf-icon cf-icon-email-social-square"></span>
                    <span class="u-visually-hidden">Share by email</span>
                </a>
            </li>
            <li class="list_item">
                <a class="share-icon"
                   href="https://www.facebook.com/dialog/share?app_id=210516218981921&amp;display=page&amp;href={{ request.url|urlencode }}&amp;redirect_uri={{ request.url|urlencode }}"
                   target="_blank">
                    <span class="cf-icon cf-icon-facebook-square"></span>
                    <span class="u-visually-hidden">Share on Facebook</span>
                </a>
            </li>
            <li class="list_item">
                <a class="share-icon"
                   href="{{ share_twitter_url(twitter_options) }}"
                   target="_blank">
                    <span class="cf-icon cf-icon-twitter-square"></span>
                    <span class="u-visually-hidden">Share on Twitter</span>
                </a>
            </li>
        </ul>
    </aside>
{% endmacro %}
