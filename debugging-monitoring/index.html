<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Debugging and Monitoring - consumerfinance.gov</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../css/overrides.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Debugging and Monitoring";
    var mkdocs_page_input_path = "debugging-monitoring.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> consumerfinance.gov</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../installation/">Setup</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Running this Project</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../running-virtualenv/">Running in a Virtual Environment</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../running-docker/">Running in Docker</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Debugging and Monitoring</a>
    <ul class="current">
    
        <ul>
        
            <li><a class="toctree-l4" href="#using-django-debug-toolbar">Using Django Debug Toolbar</a></li>
        
            <li><a class="toctree-l4" href="#logging-database-queries-to-console">Logging database queries to console</a></li>
        
            <li><a class="toctree-l4" href="#logging-elasticsearch-queries-to-console">Logging Elasticsearch queries to console</a></li>
        
            <li><a class="toctree-l4" href="#monitoring-using-new-relic">Monitoring using New Relic</a></li>
        
        </ul>
    

    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../deployment/">Artifacts and Deployment</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Pages and Components</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../atomic-structure/">Atomic Structure and Design</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../editing-components/">Creating and Editing Components</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../debugging-templates/">Debugging Templates</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../migrations/">Django and Wagtail Migrations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../forms-in-wagtail/">Forms in Wagtail Page Context</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../wagtail-pages/">Wagtail Pages</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Supporting Features</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../feature-flags/">Feature Flags</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../filterable-lists/">Filterable Lists</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../page-search/">Page Search</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../site-search/">Site Search</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../translation/">Translation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Testing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../javascript-unit-tests/">JavaScript Unit Testing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../python-unit-tests/">Python Unit Testing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../functional-testing/">Functional Testing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../profiling-django/">Profiling Django</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../other-front-end-testing/">Other Front-end Testing</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Contributing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../branching-merging/">Branching and Merging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../contributing-docs/">Contributing to the Docs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../related-projects/">Related Projects</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../development-tips/">Development Tips</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../github-actions/">How We Use GitHub Actions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">APIs and Data</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ask-cfpb/">Ask CFPB</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../consumer-complaint-database/">Consumer Complaints</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../housing-counselor-tool/">Find a Housing Counselor Tool</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../website-feedback/">Website Feedback</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">consumerfinance.gov</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Running this Project &raquo;</li>
        
      
    
    <li>Debugging and Monitoring</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/cfpb/consumerfinance.gov/edit/master/docs/debugging-monitoring.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="debugging-and-monitoring">Debugging and Monitoring<a class="headerlink" href="#debugging-and-monitoring" title="Permanent link">¶</a></h1>
<h3 id="using-django-debug-toolbar">Using Django Debug Toolbar<a class="headerlink" href="#using-django-debug-toolbar" title="Permanent link">¶</a></h3>
<p>When running locally it is possible to enable the
<a href="https://django-debug-toolbar.readthedocs.io/en/stable/">Django Debug Toolbar</a>
by defining the <code>ENABLE_DEBUG_TOOLBAR</code> environment variable:</p>
<pre class="highlight"><code class="language-sh">$ ENABLE_DEBUG_TOOLBAR=1 ./runserver.sh</code></pre>

<p>This tool exposes various useful pieces of information about things like HTTP headers,
Django settings, SQL queries, and template variables. Note that running with the toolbar on
may have an impact on local server performance.</p>
<h3 id="logging-database-queries-to-console">Logging database queries to console<a class="headerlink" href="#logging-database-queries-to-console" title="Permanent link">¶</a></h3>
<p>To log database queries to the console when running locally,
define the <code>ENABLE_SQL_LOGGING</code> environment variable:</p>
<pre class="highlight"><code class="language-sh">$ ENABLE_SQL_LOGGING=1 cfgov/manage.py shell
&gt;&gt;&gt; from django.contrib.auth import get_user_model
&gt;&gt;&gt; User = get_user_model()
&gt;&gt;&gt; User.objects.count()
(0.004) SELECT COUNT(*) AS &quot;__count&quot; FROM &quot;auth_user&quot;; args=()
97</code></pre>

<p>This will log any database queries (and time taken to execute them)
to the console, and works with any Django code invoked from the shell,
including the server and management commands:</p>
<pre class="highlight"><code class="language-sh">$ ENABLE_SQL_LOGGING=1 ./runserver.sh
$ ENABLE_SQL_LOGGING=1 cfgov/manage.py some_management_command</code></pre>

<h3 id="logging-elasticsearch-queries-to-console">Logging Elasticsearch queries to console<a class="headerlink" href="#logging-elasticsearch-queries-to-console" title="Permanent link">¶</a></h3>
<p>Similarly, to log Elasticsearch queries to the console when running locally,
define the <code>ENABLE_ES_LOGGING</code> environment variable.</p>
<p>This will log any Elasticsearch queries (and time taken to execute them)
to the console, and works with any Django code invoked from the shell,
including the server and management commands:</p>
<pre class="highlight"><code class="language-sh">$ ENABLE_ES_LOGGING=1 ./runserver.sh
$ ENABLE_ES_LOGGING=1 cfgov/manage.py some_management_command</code></pre>

<h3 id="monitoring-using-new-relic">Monitoring using New Relic<a class="headerlink" href="#monitoring-using-new-relic" title="Permanent link">¶</a></h3>
<p>This project can be configured for real-time monitoring with
<a href="https://newrelic.com/">New Relic</a>. This requires an active New Relic account
and a valid license key.</p>
<p>First, you'll need to install
<a href="https://docs.newrelic.com/docs/agents/python-agent">the New Relic Python Agent</a>
from
<a href="https://pypi.org/project/newrelic/">from PyPI</a>.
This package is not part of the standard development requirements but is
included in
the <a href="https://github.com/cfpb/consumerfinance.gov/blob/main/requirements/deployment.txt"><code>requirements/deployment.txt</code></a> file.
It can be installed into your Python environment using the following command:</p>
<pre class="highlight"><code class="language-shell">$ pip install newrelic</code></pre>

<p>New Relic monitoring is implemented by wrapping every request to the Django
web server with a call to the Python agent. This agent records information
about web requests and reports it back to New Relic's servers. Additionally,
and depending on configuration, the agent also injects a bit of JavaScript
into every page header allowing for monitoring of client-side performance
in the web browser.</p>
<p>The New Relic Python agent has many
<a href="https://docs.newrelic.com/docs/agents/python-agent/configuration/python-agent-configuration">configuration settings</a>
that control the information that gets recorded about web requests. This
project includes a default
<a href="https://github.com/cfpb/consumerfinance.gov/blob/main/cfgov/newrelic.ini"><code>newrelic.ini</code></a>
file that enables New Relic's
<a href="https://docs.newrelic.com/docs/agents/manage-apm-agents/configuration/high-security-mode">high security mode</a>
to limit the recording of potentially sensitive information.</p>
<p>To activate New Relic monitoring of your instance of cf.gov, you'll need to set
two environment variables:</p>
<ul>
<li><code>NEW_RELIC_LICENSE_KEY</code>: a valid New Relic license key</li>
<li><code>NEW_RELIC_APP_NAME</code>: a unique identifier to describe your running application</li>
</ul>
<p>Make sure to choose a unique application name to help distinguish your web
traffic from any other users who may be running against the same New Relic
account.</p>
<p>This project's
<a href="https://github.com/cfpb/consumerfinance.gov/blob/main/.env_SAMPLE"><code>.env_SAMPLE</code></a>
file contains placeholder entries for these two variables.</p>
<p>Once you've set these two variables, start or restart your local web server.</p>
<p>When you make your first web request, you'll see messages in the console
indicating that the New Relic Python agent has been activated. You should also
see a message containing a link to the New Relic console:</p>
<pre class="highlight"><code class="language-txt">Reporting to: https://rpm.newrelic.com/accounts/XXXXXXXX/applications/XXXXXXXX</code></pre>

<p>You should now be able to use that link to navigate to the New Relic console
and, after a few seconds, see your web server traffic in New Relic APM and
New Relic Browser.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../deployment/" class="btn btn-neutral float-right" title="Artifacts and Deployment">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../running-docker/" class="btn btn-neutral" title="Running in Docker"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/cfpb/consumerfinance.gov/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../running-docker/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../deployment/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
