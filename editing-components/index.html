<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Creating and Editing Components - consumerfinance.gov</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/overrides.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Creating and Editing Components";
        var mkdocs_page_input_path = "editing-components.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> consumerfinance.gov
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Setup</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Running this Project</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../running-virtualenv/">Running in a Virtual Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../running-docker/">Running in Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging-monitoring/">Debugging and Monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deployment/">Artifacts and Deployment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Pages and Components</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../atomic-structure/">Atomic Structure and Design</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Creating and Editing Components</a>
    <ul class="current">
    
        <ul>
        
            <li><a class="toctree-l4" href="#table-of-contents">Table of contents</a></li>
        
            <li><a class="toctree-l4" href="#the-parts-of-a-wagtail-block">The parts of a Wagtail block</a></li>
        
            <li><a class="toctree-l4" href="#how-to-guides">How-to guides</a></li>
        
        </ul>
    

    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging-templates/">Debugging Templates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../migrations/">Django and Wagtail Migrations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wagtail-pages/">Wagtail Pages</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Supporting Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../feature-flags/">Feature Flags</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../filterable-lists/">Filterable Lists</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../page-search/">Page Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../site-search/">Site Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../translation/">Translation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Testing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../javascript-unit-tests/">JavaScript Unit Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../python-unit-tests/">Python Unit Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../functional-testing/">Functional Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../profiling-django/">Profiling Django</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../other-front-end-testing/">Other Front-end Testing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../branching-merging/">Branching and Merging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing-docs/">Contributing to the Docs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../related-projects/">Related Projects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development-tips/">Development Tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../github-actions/">How We Use GitHub Actions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">APIs and Data</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ask-cfpb/">Ask CFPB</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../consumer-complaint-database/">Consumer Complaints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../housing-counselor-tool/">Find a Housing Counselor Tool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../website-feedback/">Website Feedback</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">consumerfinance.gov</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Pages and Components &raquo;</li><li>Creating and Editing Components</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/cfpb/consumerfinance.gov/edit/master/docs/editing-components.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="creating-and-editing-wagtail-components">Creating and Editing Wagtail Components<a class="headerlink" href="#creating-and-editing-wagtail-components" title="Permanent link">¶</a></h1>
<p>consumerfinance.gov implements a number of components
that editors can choose from when building a page,
for example: Heroes, Expandable Groups, or Info Unit Groups. The
<a href="https://cfpb.github.io/design-system/components/">CFPB Design System</a>
describes the design and intended usage of many of these components.</p>
<p>In Wagtail parlance, these are called
<a href="https://docs.wagtail.io/en/stable/topics/streamfield.html">"StreamField blocks"</a>*
(or just "blocks").
We sometimes also refer to them as "modules", because we think that
the terms "component" and "module" may be more obvious to non-developers.
This page will use the terms somewhat interchangeably.
One other important thing to note before we begin:
blocks can be nested within other blocks.</p>
<p><em>* If you're going to be doing anything more than making minor updates to
   existing components, this is highly recommended reading.</em></p>
<h2 id="table-of-contents">Table of contents<a class="headerlink" href="#table-of-contents" title="Permanent link">¶</a></h2>
<ol>
<li><a href="#the-parts-of-a-wagtail-block">The parts of a Wagtail block</a><ol>
<li><a href="#the-back-end">The back end</a><ol>
<li><a href="#the-python-class">The Python class</a></li>
<li><a href="#adding-it-to-a-streamfield">Adding it to a StreamField</a></li>
</ol>
</li>
<li><a href="#the-front-end">The front end</a><ol>
<li><a href="#the-html-template">The HTML template</a></li>
<li><a href="#adding-css">Adding CSS</a></li>
<li><a href="#adding-javascript">Adding JavaScript</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#how-to-guides">How-to guides</a><ol>
<li><a href="#creating-a-new-component">Creating a new component</a></li>
<li><a href="#adding-a-field-to-an-existing-component">Adding a field to an existing component</a></li>
<li><a href="#editing-a-field-on-an-existing-component">Editing a field on an existing component</a></li>
<li><a href="#removing-a-field-from-an-existing-component">Removing a field from an existing component</a></li>
<li><a href="#creating-migrations-for-streamfield-blocks">Creating migrations for StreamField blocks</a></li>
</ol>
</li>
</ol>
<h2 id="the-parts-of-a-wagtail-block">The parts of a Wagtail block<a class="headerlink" href="#the-parts-of-a-wagtail-block" title="Permanent link">¶</a></h2>
<p>Blocks are implemented via several different bits of code:</p>
<ol>
<li><a href="#the-python-class">Defining a block's fields and other properties in a Python class</a></li>
<li><a href="#adding-it-to-a-streamfield">Adding the class to a page's StreamField block options</a></li>
<li><a href="#the-html-template">Creating an HTML template for rendering the block on a page</a></li>
<li><a href="#adding-css">(Optionally) adding some CSS for styling the block</a></li>
<li><a href="#adding-javascript">(Optionally) adding some JavaScript for adding advanced behavior</a></li>
</ol>
<p>Before you dive in further,
<a href="../atomic-structure/">check out the Notes on Atomic Design page</a>
and familiarize yourself with our basic concepts
of atoms, molecules, and organisms.</p>
<h3 id="the-back-end">The back end<a class="headerlink" href="#the-back-end" title="Permanent link">¶</a></h3>
<h4 id="the-python-class">The Python class<a class="headerlink" href="#the-python-class" title="Permanent link">¶</a></h4>
<p>A component's fields and other properties are defined in a Python class,
typically a subclass of Wagtail's
<a href="http://docs.wagtail.io/en/stable/topics/streamfield.html#structblock"><code>StructBlock</code></a>.
These classes are located in a number of different files across the repository,
but there are two major categories they fall into:</p>
<ol>
<li>Files corresponding to a general-purpose, site-wide atomic component.
   These files—<code>atoms.py</code>, <code>molecules.py</code>, and <code>organisms.py</code>—are located in
   <a href="https://github.com/cfpb/consumerfinance.gov/tree/main/cfgov/v1/atomic_elements"><code>cfgov/v1/atomic_elements</code></a>.</li>
<li>Files that are specific to a particular sub-app, such as regulations3k's
   <a href="https://github.com/cfpb/consumerfinance.gov/blob/main/cfgov/regulations3k/blocks.py">blocks.py</a>.</li>
</ol>
<p>There are other places where StreamField block classes are defined
(particularly blocks that are only ever used as fields within another block),
but these are the two most common locations
where top-level Wagtail modules are stored.</p>
<p>A simple component class looks like this:</p>
<pre class="highlight"><code class="language-python">class RelatedContent(blocks.StructBlock):                      # 1
    heading = blocks.CharBlock(required=False)                 # 2
    paragraph = blocks.RichTextBlock(required=False)           # 3
    links = blocks.ListBlock(atoms.Hyperlink())                # 4

    class Meta:                                                # 5
        icon = 'grip'                                          # 6
        label = 'Related content'                              # 7
        template = '_includes/molecules/related-content.html'  # 8</code></pre>
<p>There are a few things happening here:</p>
<ol>
<li>The <code>RelatedContent</code> class is a subclass of
   <a href="https://docs.wagtail.io/en/stable/topics/streamfield.html#structblock">Wagtail's <code>StructBlock</code></a>,
   which allows for the combination of a fixed number of other sub-blocks
   (see previous comment about blocks being nested within other blocks)
   into a single unit (what we'd think of as a "module" in the Wagtail editor).
   This one has three sub-blocks (lines 2, 3, and 4).</li>
<li>The <code>heading</code> field uses the basic Wagtail
   <a href="https://docs.wagtail.io/en/stable/topics/streamfield.html#charblock"><code>CharBlock</code></a>,
   which results in a field with a basic single-line text input.</li>
<li>The <code>paragraph</code> field uses the basic Wagtail
   <a href="https://docs.wagtail.io/en/stable/topics/streamfield.html#richtextblock"><code>RichTextBlock</code></a>,
   which results in a field with a multiline WYSIWYG text input.</li>
<li>The <code>links</code> field uses another basic Wagtail block,
   <a href="https://docs.wagtail.io/en/stable/topics/streamfield.html#listblock"><code>ListBlock</code></a>,
   which is a special type of block that can hold a variable number of
   some other block (the <code>Hyperlink</code> atom block, in this case).</li>
<li>The <code>Meta</code> class defines some properties on the <code>RelatedContent</code> block
   that are used by the Wagtail admin or in rendering the block.</li>
<li>The <code>icon</code> property tells Wagtail what icon to use in the editor
   for the button you use to add a <code>RelatedContent</code> block to a StreamField.
   Icon options can be found in the Wagtail style guide when running locally:
   <a href="http://localhost:8000/admin/styleguide/#icons">http://localhost:8000/admin/styleguide/#icons</a></li>
<li>The optional <code>label</code> property overrides the text of that same button;
   if <code>label</code> is not set, Wagtail will generate one from the name of the block.</li>
<li>The <code>template</code> property is a pointer to the HTML template used to render
   this component. <a href="#the-html-template">See below for more on templates.</a></li>
</ol>
<p>This results in a module that looks like this in the Wagtail editor:</p>
<p><img alt="A screenshot of a Related Content module with heading, paragraph, and links fields" src="../img/related-content-module.png" /></p>
<p>Note again that what we think of as <strong>fields</strong> are <em>also</em> blocks,
and what we think of as <strong>components</strong> or <strong>modules</strong>
are a special kind of block, <code>StructBlock</code>,
that comprise the sub-blocks that are our fields.</p>
<p>There are two common optional things that are also used in component classes:</p>
<ol>
<li><a href="http://docs.wagtail.io/en/stable/topics/streamfield.html#streamfield-get-context">Overriding the default <code>get_context</code> method</a>
   to pass additional data to the template</li>
<li><a href="#adding-javascript">Adding component-specific JavaScript</a>
    via the <code>Media</code> class</li>
</ol>
<h4 id="adding-it-to-a-streamfield">Adding it to a StreamField<a class="headerlink" href="#adding-it-to-a-streamfield" title="Permanent link">¶</a></h4>
<p>Components are made available in the page editing interface
by adding them to one of a page types's StreamFields.
These are usually the first things in a page's class definition.
For example, see this snippet from
<a href="https://github.com/cfpb/consumerfinance.gov/blob/main/cfgov/v1/models/blog_page.py"><code>blog_page.py</code></a>:</p>
<pre class="highlight"><code class="language-python">class BlogPage(AbstractFilterPage):
    content = StreamField([
        ('full_width_text', organisms.FullWidthText()),
        ('info_unit_group', organisms.InfoUnitGroup()),
        ('expandable', organisms.Expandable()),
        ('well', organisms.Well()),
        ('email_signup', organisms.EmailSignUp()),
    ])
    …</code></pre>
<p>This sets up a StreamField named <code>content</code> that allows for
the insertion of any of those seven listed blocks into it.</p>
<p>To make the <code>RelatedContent</code> module (shown above) available to this StreamField,
we'd add a new entry to this list following the same format:
<code>('related_content', molecules.RelatedContent()),</code>.</p>
<p>Most page types have two StreamFields (<code>header</code> and <code>content</code>) in the
general content area (the first tab on an editing screen), and most also share
<a href="https://github.com/cfpb/consumerfinance.gov/blob/main/cfgov/v1/models/base.py#L95-L107">a common <code>sidefoot</code> StreamField</a>
(so named for the fact that it appears on the right side on some page types,
but in the footer on others) on the sidebar tab.</p>
<hr />
<div class="admonition note">
<p class="admonition-title">Don't forget the migrations!</p>
<p>Adding or changing fields on either Python class will always require a new
<a href="https://docs.djangoproject.com/en/1.11/topics/migrations/">Django schema migration</a>;
additionally, changing field names or types
on an existing block will require a
<a href="https://docs.djangoproject.com/en/1.11/topics/migrations/#data-migrations">Django data migration</a>.
See the guide on
<a href="#creating-migrations-for-streamfield-blocks">creating migrations for StreamField blocks</a>
for more details.</p>
</div>
<h3 id="the-front-end">The front end<a class="headerlink" href="#the-front-end" title="Permanent link">¶</a></h3>
<p>Before diving into the front-end code, a reminder to
visit the <a href="../atomic-structure/">Notes on Atomic Design</a> page
to learn about how we conceive of components in a hierarchy
of atoms, molecules, and organisms.</p>
<h4 id="the-html-template">The HTML template<a class="headerlink" href="#the-html-template" title="Permanent link">¶</a></h4>
<p>Frontend rendering of Wagtail StreamField blocks to HTML
can be controlled by writing a Django template
and associating it with the block type.
A custom block definition can specify the template path in its <code>Meta</code> class:</p>
<pre class="highlight"><code class="language-python">from wagtail.core import blocks


class PersonBlock(blocks.StructBlock):
    name = blocks.CharBlock()
    email = blocks.EmailBlock()

    class Meta:
        template = 'myapp/blocks/person_block.html'</code></pre>
<p>StreamField block templates are loaded by the Django template loader
in the same way that Django page templates are.
The specified template path must be loadable
by one of the Django template engines configured in
<a href="https://docs.djangoproject.com/en/1.11/ref/settings/#std:setting-TEMPLATES"><code>settings.TEMPLATES</code></a>.
(This project supports both the standard
<a href="https://docs.djangoproject.com/en/2.1/topics/templates/#django.template.backends.django.DjangoTemplates">Django templates backend</a>
and the
<a href="https://docs.djangoproject.com/en/2.1/topics/templates/#django.template.backends.jinja2.Jinja2">Jinja2 backend</a>,
but Jinja2 is more commonly used.)
<a href="https://docs.djangoproject.com/en/1.11/topics/templates/#usage">See the Django templates documentation</a>
for more details on the search algorithm used to locate a template.</p>
<p>Returning to the <code>RelatedContent</code> example,
this is what its Jinja2 template looks like (comments excluded):</p>
<pre class="highlight"><code class="language-html">&lt;div class="m-related-content"&gt;
    {% if value.heading %}
        &lt;header class="m-slug-header"&gt;
            &lt;h2 class="a-heading"&gt;
                {{ value.heading }}
            &lt;/h2&gt;
        &lt;/header&gt;
    {% endif %}

    {{ value.paragraph | safe }}

    {% if value.links %}
        &lt;ul class="m-list m-list__links"&gt;
        {% for link in value.links %}
            &lt;li class="m-list_item"&gt;
                &lt;a href="{{ link.url }}" class="m-list_link"&gt;{{ link.text }}&lt;/a&gt;
            &lt;/li&gt;
        {% endfor %}
        &lt;/ul&gt;
    {% endif %}
&lt;/div&gt;</code></pre>
<p>When Wagtail renders a block,
it includes the values of its fields in an object named <code>value</code>.
Above, you can see where the <code>heading</code> and <code>paragraph</code> fields are output with
<a href="http://jinja.pocoo.org/docs/2.10/templates/#expressions">Jinja2 expression tags</a>.
And note how the <code>links</code> field (a <code>ListBlock</code>) is iterated over,
and the values of <em>its</em> <code>Hyperlink</code> child blocks are output.</p>
<p>That's about as simple an example as it gets, but block templates can get much
more complex when they have lots of child blocks and grandchild blocks.
Also, if a block definition has overridden <code>get_context</code> to pass other data
into the template (as described at the end of
<a href="#the-python-class">the Python class section</a> above),
those context variables can also be output with simple Jinja2 expression tags:
<code>{{ context_var }}</code>.</p>
<h4 id="adding-css">Adding CSS<a class="headerlink" href="#adding-css" title="Permanent link">¶</a></h4>
<p>If a component needs any custom styling not already provided
by the <a href="https://github.com/cfpb/design-system">Design System</a> or consumerfinance.gov,
you can add it by creating a new
<a href="http://lesscss.org/">Less</a> file for the component.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please be sure that you actually need new Less before creating it.
We have a wide array of styles already available in the
<a href="https://cfpb.github.io/design-system/components/">Design System components</a> and
<a href="https://github.com/cfpb/consumerfinance.gov/tree/main/cfgov/unprocessed/css">here in consumerfinance.gov</a>,
some of which could perhaps be combined to achieve your desired result.
Also be sure that new component designs have gone through
our internal approval process before adding them to the project.</p>
</div>
<p>If you're working on a general-purpose <a href="../atomic-structure/">atomic component</a>
for site-wide use, this file should live in
<code>cfgov/unprocessed/css/&lt;atoms|molecules|organisms&gt;/</code>.
(Choose the deepest folder according to the atomic rank of the component.)
Continuing the <code>RelatedContent</code> example, if it needed its own styles,
it would live at <code>cfgov/unprocessed/css/molecules/related-content.less</code>.</p>
<p>Newly-created Less files need to be imported into the project's main
<code>main.less</code> file, located at <code>cfgov/unprocessed/css/main.less</code>.
Please place them in the appropriate section for their atomic rank.</p>
<p>Because consumerfinance.gov uses <code>main.less</code> to build a single CSS file
for almost the entire project, it is not necessary
to tell the Python model anything about a component-specific stylesheet
(for general-purpose, site-wide components).
That is <em>not</em> the case with JavaScript, as we will see in the next section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you're working on a component that belongs to a particular sub-app,
its Less file should live in <code>cfgov/unprocessed/&lt;app-name&gt;/css/</code>.</p>
</div>
<h4 id="adding-javascript">Adding JavaScript<a class="headerlink" href="#adding-javascript" title="Permanent link">¶</a></h4>
<p>Each atomic component may optionally be given a <code>Media</code> class that can
list one or more JavaScript files that should be loaded when using it.
When a page is requested via the browser,
<a href="https://github.com/cfpb/consumerfinance.gov/blob/main/cfgov/jinja2/v1/_layouts/base.html#L100-L110">code contained in <code>base.html</code></a>
will loop all atomic components for the requested page and
load the appropriate atomic JavaScript bundles.</p>
<p>Here is how one would add the <code>Media</code> class to our <code>RelatedContent</code> example:</p>
<pre class="highlight"><code class="language-python">class RelatedContent(blocks.StructBlock):
    …  # see first example on this page

    class Media:
        js = ['related-content.js']</code></pre>
<p>(The <code>related-content.js</code> file would need to be placed in
<code>cfgov/unprocessed/js/molecules/</code>;
see <a href="../atomic-structure/">Notes on Atomic Design</a>.)</p>
<p>This will load the <code>related-content.js</code> script on any page
that includes the <code>RelatedContent</code> molecule in one of its StreamFields.</p>
<h2 id="how-to-guides">How-to guides<a class="headerlink" href="#how-to-guides" title="Permanent link">¶</a></h2>
<h3 id="creating-a-new-component">Creating a new component<a class="headerlink" href="#creating-a-new-component" title="Permanent link">¶</a></h3>
<ol>
<li>Review the <a href="../atomic-structure/">Notes on Atomic Design</a> page.</li>
<li>Add each of the parts mentioned above:<ol>
<li><a href="#the-python-class">Create the Python class</a></li>
<li><a href="#adding-it-to-a-streamfield">Add the class to a StreamField</a></li>
<li><a href="#the-html-template">Create an HTML template for the component</a></li>
<li><a href="#adding-css">(Optionally) add some CSS</a></li>
<li><a href="#adding-javascript">(Optionally) add some JavaScript</a></li>
</ol>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before creating a new component,
please consider whether one of our existing components can meet your needs.
Talk to the consumerfinance.gov product owners if
your content has specific display requirements that aren't served
by an existing component, or if
a specific maintenance efficiency will be gained from a new component.</p>
</div>
<h3 id="adding-a-field-to-an-existing-component">Adding a field to an existing component<a class="headerlink" href="#adding-a-field-to-an-existing-component" title="Permanent link">¶</a></h3>
<ol>
<li>Locate the Python class of the component you want to add a field to.</li>
<li>Add the field by inserting a snippet like this in the list of fields,
   in the order in which you want it to appear in the editor:
   <code>field_name = blocks.BlockName()</code>.<ul>
<li>Replace <code>field_name</code> with a succinct name for what data the field contains</li>
<li>Replace <code>BlockName</code> with one of the
  <a href="https://docs.wagtail.io/en/stable/topics/streamfield.html#basic-block-types">basic Wagtail block types</a>.
  Sometimes we create our own custom blocks that can be used, as well.
  See, for example, the
  <a href="https://github.com/cfpb/consumerfinance.gov/blob/main/cfgov/v1/blocks.py#L147-L165"><code>HeadingBlock</code></a>,
  <a href="https://github.com/cfpb/consumerfinance.gov/blob/main/cfgov/v1/atomic_elements/organisms.py#L54">used in <code>InfoUnitGroup</code></a>,
  among other places.</li>
</ul>
</li>
<li>Add any desired parameters:<ul>
<li><code>required=False</code> if you do <em>not</em> want the field to be required
  (it usually is, by default)</li>
<li><code>label='Some label'</code> if you would like the editor to show a label more
  meaningful than the sentence-case transformation of the field name</li>
<li><code>help_text='Some text'</code> if the field needs a more verbose explanation to
  be shown in the editor to make it clear to users how it should work</li>
<li><code>default=&lt;some appropriate value&gt;</code> if you want the field to have a
  specific default value, e.g., <code>True</code> to have a <code>BooleanBlock</code> checkbox
  default to checked.</li>
<li>Certain blocks may take other arguments, as described in the
  <a href="https://docs.wagtail.io/en/stable/topics/streamfield.html#basic-block-types">basic Wagtail blocks documentation</a>.</li>
</ul>
</li>
<li><a href="#the-html-template">Edit the component template</a> to do something with the
   field's data – output it, use it to trigger a CSS class, etc.</li>
<li><a href="#creating-migrations-for-streamfield-blocks">Create a schema migration.</a></li>
</ol>
<h3 id="editing-a-field-on-an-existing-component">Editing a field on an existing component<a class="headerlink" href="#editing-a-field-on-an-existing-component" title="Permanent link">¶</a></h3>
<ol>
<li><a href="#you-may-also-need-a-data-migration">Determine if the change you want to make will need a data migration.</a><ul>
<li>If the answer is <strong>no</strong>: make your changes,
  <a href="#creating-migrations-for-streamfield-blocks">create a schema migration</a>, and be on your merry way.</li>
<li>If the answer is <strong>yes</strong>: continue on.</li>
</ul>
</li>
<li><a href="#adding-a-field-to-an-existing-component">Add the new version of the field.</a></li>
<li><a href="#creating-migrations-for-streamfield-blocks">Create a schema migration</a> for adding the new field.</li>
<li><a href="#you-may-also-need-a-data-migration">Create a data migration</a>
   to copy data from the old field into the new field.</li>
<li><a href="#the-html-template">Edit the component template</a>
   to use the new field's data instead of the old field's data.</li>
<li><a href="#removing-a-field-from-an-existing-component">Remove the old field.</a></li>
<li><a href="#creating-migrations-for-streamfield-blocks">Create a schema migration</a> for removing the old field.</li>
</ol>
<h3 id="removing-a-field-from-an-existing-component">Removing a field from an existing component<a class="headerlink" href="#removing-a-field-from-an-existing-component" title="Permanent link">¶</a></h3>
<p>These instructions presume that you do not care
about any data stored in the field you are deleting.
If that is not the case, please go up to the
<a href="#editing-a-field-on-an-existing-component">instructions for editing a field</a>
and come back here when instructed.</p>
<ol>
<li>Locate the field you want to remove in the block's Python class.</li>
<li>Delete the field definition.</li>
<li><a href="#creating-migrations-for-streamfield-blocks">Create a schema migration.</a></li>
</ol>
<h3 id="creating-migrations-for-streamfield-blocks">Creating migrations for StreamField blocks<a class="headerlink" href="#creating-migrations-for-streamfield-blocks" title="Permanent link">¶</a></h3>
<p>To automatically generate a <strong>schema migration</strong>, run
<code>./cfgov/manage.py makemigrations -n &lt;description_of_changes&gt;</code>
from the root of the repository.</p>
<h4 id="you-may-also-need-a-data-migration">You may also need a data migration<a class="headerlink" href="#you-may-also-need-a-data-migration" title="Permanent link">¶</a></h4>
<p>Some field edits (like changing the <code>default</code>, <code>label</code>, <code>help_text</code>,
and <code>required</code> properties, or changing the order of fields on a block)
do not require a data migration. A schema migration is sufficient.</p>
<p>Data migrations are required any time you:</p>
<ul>
<li>rename an existing field</li>
<li>change the type of an existing field</li>
<li>delete an existing field</li>
<li>rename a block within a StreamField</li>
<li>delete a block</li>
</ul>
<p>if you do not want to lose any data already stored in that field or block.</p>
<p>In other words, if an existing field or block is changing,
any data stored in that field or block has to be migrated to a different place,
unless you're OK with jettisoning it.</p>
<h5 id="not-sure-if-theres-actually-any-data-that-could-potentially-be-lost">Not sure if there's actually any data that could potentially be lost?<a class="headerlink" href="#not-sure-if-theres-actually-any-data-that-could-potentially-be-lost" title="Permanent link">¶</a></h5>
<p>You may not know off the top of your head if a component you are modifying
actually has any data stored that could be lost.
One way that you can manually check to see if this is the case
is to use the Block Inventory feature that
<a href="https://github.com/cfpb/wagtail-inventory">we added to Wagtail</a>.
This feature lets you search all Wagtail pages on the site
for the presence of a component. Here's how:</p>
<ol>
<li>With a current database dump, visit <a href="http://localhost:8000/admin/inventory/">http://localhost:8000/admin/inventory/</a>.
   (This is also available from the admin menu by going to
   <strong>Settings</strong> &gt; <strong>Block Inventory</strong>.)</li>
<li>Using the three pairs of dropdown menus at the top of the page,
   choose to look for pages that either
   <em>include</em> or <em>exclude</em> particular components.<ul>
<li>If multiple components are selected, resulting pages must
  match <em>all</em> of the conditions.</li>
</ul>
</li>
<li>Click <strong>Find matching pages</strong> to execute the search.</li>
<li>If no results are found, lucky you!
   You're in the clear to make whatever changes you desire to that component
   without worrying about data loss.</li>
<li>If, more likely, there <em>are</em> results, you should open each result,
   look through the page for the instance(s) of the component in question, and
   see if the changes you want to make would cause the loss of important data.</li>
</ol>
<p>If there is only a small amount of potential data loss,
it may be more practical to forego the data migration and
manually replace that data once the code changes have been deployed.
If you think this is the preferable route,
consult with the appropriate stakeholders to confirm that
they are OK with the window of time in which users may
experience a gap in the data that is being manually replaced.</p>
<hr />
<p>For more details on both kinds of migrations,
see <a href="../migrations/">the Wagtail Migrations page</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../atomic-structure/" class="btn btn-neutral float-left" title="Atomic Structure and Design"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../debugging-templates/" class="btn btn-neutral float-right" title="Debugging Templates">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/cfpb/consumerfinance.gov" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../atomic-structure/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../debugging-templates/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
