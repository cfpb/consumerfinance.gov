{% extends "layout-2-1-bleedbar.html" %}
{% import "_section-blog.html" as section with context %}
{% import "post-macros.html" as post_macros with context %}

{# Variables #}

{% set active_filters =
   selected_filters_for_field('category') +
   selected_filters_for_field('tags') +
   selected_filters_for_field('author')
%}
{% set active_date_filters =
   selected_filters_for_field('range_date_gte') + 
   selected_filters_for_field('range_date_lte')
%}
{% set active_filters_total = active_filters|length + active_date_filters|length %}
{% set view = get_document('views', 'blog') %}

{# Block overrides #}

{% block demo_title -%}
    Blog listing
{%- endblock %}

{% block title -%}
    Blog
{%- endblock %}

{% block desc -%}
    The official blog of the Consumer Financial Protection Bureau
{%- endblock %}

{% block hero scoped %}
    {# Only show the hero when:
       1. No filters have been applied
       2. We are on the first page of paginated results
    #}
    {% if active_filters_total == 0 and section.posts.current_page == 1 %}
        {% import "hero.html" as hero %}
        {{ hero.render(view.hero, post_macros) }}
    {% endif %}
{% endblock %}

{% block content_main scoped %}
    {% import "post-filters.html" as post_filters %}
    {{ post_filters.render(section.posts, active_filters, active_filters_total, active_date_filters, section.query, post_macros, selected_filters_for_field, current_date, section.path) }}
    {% import "posts-paginated.html" as posts_paginated %}
    {{ posts_paginated.render(section.posts, post_macros) }}
{% endblock %}

{% block content_sidebar scoped %}
    <section class="content_block content_block__flush-top">
        {% import "popular-posts.html" as popular_posts %}
        {{ popular_posts.render(view.popular_posts, get_document) }}
    </section>
    <section class="content_block">
        <h1 class="header-slug">
            <span class="header-slug_inner">
                Stay informed
            </span>
        </h1>
        <div class="content_block content_block__sub content_block__flush-top">
            <p class="short-desc">
                Subscribe to our email newsletter. We will update you on new blogs.
            </p>
            {% import "email-subscribe-form.html" as email_subscribe_form %}
            {{ email_subscribe_form.render(section.query) }}
        </div>
        <div class="content_block content_block__sub">
            {% import "rss.html" as rss %}
            {{ rss.render(section.rss_path) }}
        </div>
    </section>
{% endblock %}
