<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Functional Testing - consumerfinance.gov</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/overrides.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Functional Testing";
        var mkdocs_page_input_path = "functional-testing.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> consumerfinance.gov
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Setup</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Running this Project</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../running-virtualenv/">Running in a Virtual Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../running-docker/">Running in Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../running-docs/">Running documentation site locally</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging-monitoring/">Debugging and Monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deployment/">Artifacts and Deployment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Pages and Components</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../atomic-structure/">Atomic Structure and Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../editing-components/">Creating and Editing Components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging-templates/">Debugging Templates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../migrations/">Django and Wagtail Migrations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wagtail-pages/">Wagtail Pages</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Supporting Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../feature-flags/">Feature Flags</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../filterable-lists/">Filterable Lists</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../page-search/">Page Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../site-search/">Site Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../translation/">Translation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Testing</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../javascript-unit-tests/">JavaScript Unit Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../python-unit-tests/">Python Unit Testing</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Functional Testing</a>
    <ul class="current">
    
        <ul>
        
            <li><a class="toctree-l4" href="#installing-cypress">Installing Cypress</a></li>
        
            <li><a class="toctree-l4" href="#running-cypress-tests">Running Cypress tests</a></li>
        
            <li><a class="toctree-l4" href="#writing-cypress-tests">Writing Cypress tests</a></li>
        
            <li><a class="toctree-l4" href="#creating-test-data">Creating test data</a></li>
        
        </ul>
    

    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../profiling-django/">Profiling Django</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../other-front-end-testing/">Other Front-end Testing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../branching-merging/">Branching and Merging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing-docs/">Contributing to the Docs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../related-projects/">Related Projects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development-tips/">Development Tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../github-actions/">How We Use GitHub Actions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">APIs and Data</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ask-cfpb/">Ask CFPB</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../consumer-complaint-database/">Consumer Complaints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../housing-counselor-tool/">Find a Housing Counselor Tool</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">consumerfinance.gov</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Testing &raquo;</li><li>Functional Testing</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/higs4281/consumerfinance.gov/edit/master/docs/functional-testing.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="functional-testing-with-cypress">Functional Testing with Cypress<a class="headerlink" href="#functional-testing-with-cypress" title="Permanent link">¶</a></h1>
<p>We use <a href="https://www.cypress.io">Cypress</a> for functional testing. Our functional tests make sure that common elements and critical pages are working correctly on the front end by simulating interactions with consumerfinance.gov in a browser. They're particularly useful in giving us confidence that our code is working as intended through dependency upgrades.</p>
<h2 id="installing-cypress">Installing Cypress<a class="headerlink" href="#installing-cypress" title="Permanent link">¶</a></h2>
<p>We have included Cypress as a dependency of this project. The only installation step is doing a fresh <code>yarn</code> if you haven't already.</p>
<h2 id="running-cypress-tests">Running Cypress tests<a class="headerlink" href="#running-cypress-tests" title="Permanent link">¶</a></h2>
<h3 id="cypress-app">Cypress app<a class="headerlink" href="#cypress-app" title="Permanent link">¶</a></h3>
<p>To run the desktop Cypress app execute <code>yarn cypress open</code> from the command line. From the app, you can select the tests you want to run and the browser you want to run them in.</p>
<h3 id="command-line">Command line<a class="headerlink" href="#command-line" title="Permanent link">¶</a></h3>
<p>You can run functional tests from the command line with <code>yarn cypress run</code>. That will run all tests in the <code>test/cypress/integration/</code> directory with the default test configuration: headless, in Cypress's default Electron browser, and against <code>localhost:8000</code>. You might want to modify the test run with some common arguments:</p>
<ul>
<li><code>--spec test/cypress/integration/{path/to/test.js}</code> runs a single test suite</li>
<li><code>--browser chrome</code> runs the tests in Chrome, which is what we use to run tests in our continuous integration pipeline</li>
<li><code>--headed</code> shows the browser and Cypress output as the tests run, handy for watching what's happening during the tests</li>
<li><code>--no-exit</code> will keep the browser and Cypress output open after the tests complete, handy to inspect any errors</li>
<li><code>--config baseUrl={url}</code> will run the tests against a server other than <code>localhost:8000</code></li>
</ul>
<p>Cypress's <a href="https://docs.cypress.io/guides/guides/command-line.html#Options">command line documentation</a> has the list of all the options you can set.</p>
<h2 id="writing-cypress-tests">Writing Cypress tests<a class="headerlink" href="#writing-cypress-tests" title="Permanent link">¶</a></h2>
<p>When developing new tests for Cypress, it is important to consider what the test is trying to accomplish. We want to ensure that we are not polluting our Cypress tests with things that can be tested at another level, like in unit tests.</p>
<p>When adding a test it is often helpful to separate the arrange/act code from the actual assertions in order to improve the readability of our testing code. To do this we have adopted the page model of testing, where we define a page within the application and the methods of interacting with the page separate from the test file itself where we define the assertions. We call these files "helpers" and label them as such (example: <code>megamenu-helpers.js</code>), and we include them alongside the test files themselves in the <code>test/cypress/integration/</code> directory. (They are ignored when running tests thanks to the configuration of <code>cypress.json</code>.)</p>
<p>For example consider the <code>ConsumerTools</code> page "helper":</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ConsumerTools</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">  </span><span class="nx">open</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/consumer-tools/&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nx">signUp</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;.o-form__email-signup&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;input:first&#39;</span><span class="p">).</span><span class="nx">type</span><span class="p">(</span><span class="nx">email</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;button:first&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nx">successNotification</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;.m-notification_message&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Notice how this class defines functions to retrieve and modify elements on the page but in a more human readable manner. This allows our test file for consumer tools to look like:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">ConsumerTools</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./consumer-tools-helpers&#39;</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ConsumerTools</span><span class="p">();</span><span class="w"></span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Consumer Tools&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Should have an email sign up&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Arrange</span><span class="w"></span>
<span class="w">    </span><span class="nx">page</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Act</span><span class="w"></span>
<span class="w">    </span><span class="nx">page</span><span class="p">.</span><span class="nx">signUp</span><span class="p">(</span><span class="s1">&#39;testing@cfpb.gov&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Assert</span><span class="w"></span>
<span class="w">    </span><span class="nx">page</span><span class="p">.</span><span class="nx">successNotification</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;exist&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nx">page</span><span class="w"></span>
<span class="w">      </span><span class="p">.</span><span class="nx">successNotification</span><span class="p">()</span><span class="w"></span>
<span class="w">      </span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Your submission was successfully received.&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>
<p>Overall it lets our tests show what is intended to be happening on a page without showing the more technical side of how we reference and interact with elements.</p>
<h3 id="skipping-tests">Skipping tests<a class="headerlink" href="#skipping-tests" title="Permanent link">¶</a></h3>
<p>We use the <a href="https://github.com/cypress-io/cypress-skip-test/">cypress-skip-test</a> plugin to define directly in the spec file under what conditions tests should run. The plugin lets you specify any tests that should not run or should only run in certain environments, on certain browsers, or at certain base URLs. While ideally we want all tests to run everywhere, skipping tests can be handy when you want to merge work-in-progress tests into <code>main</code> but skip them in CI/CD pipelines until they work is finished or when you want to temporarily skip a test that's failing while you debug it.</p>
<h2 id="creating-test-data">Creating test data<a class="headerlink" href="#creating-test-data" title="Permanent link">¶</a></h2>
<p>Wagtail pages can be created programmatically by adding function calls to cfgov/v1/tests/wagtail_pages/create_test_data.py
To run this file locally, run the following commands on a bash shell within
the python container from the root folder:</p>
<p><code>./cfgov/manage.py shell</code>
<code>from v1.tests.wagtail_pages import create_test_data</code></p>
<p>Currently supported page types:</p>
<ul>
<li>blog_page</li>
<li>browse_filterable_page</li>
<li>browse_page</li>
<li>landing_page</li>
<li>learn_page</li>
<li>sublanding_filterable_page</li>
<li>sublanding_page</li>
</ul>
<p>To import "create a page" functions, import from:</p>
<ul>
<li>v1.tests.wagtail_pages.helpers</li>
</ul>
<p>"Create a page" functions return a path to the created page or None if no page was created</p>
<p>When adding tags or categories, they should be passed as a set:
<code>MY_TAGS = {"a tag", "another tag"}</code></p>
<p>The first three arguments of any "create a page" function are title, slug, and parent path (optional, defaults to root)</p>
<p>Do not include new functions that only add test data in a pull request. When you are done running the test data creation
script, remove your created functions and only leave the documentation.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../python-unit-tests/" class="btn btn-neutral float-left" title="Python Unit Testing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../profiling-django/" class="btn btn-neutral float-right" title="Profiling Django">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/higs4281/consumerfinance.gov" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../python-unit-tests/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../profiling-django/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
