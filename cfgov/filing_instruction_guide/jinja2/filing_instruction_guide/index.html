{% set is_report = True %}
{% extends 'layout-side-nav.html' %}

{% import 'templates/streamfield-sidefoot.html' as streamfield_sidefoot with context %}

{% block css %}
{{ super() }}
<link rel="stylesheet" href="{{ static('css/on-demand/reports-sidenav.css') }}">
{% endblock %}

{% block content_main_modifiers -%}
    {{ super() }} content__flush-bottom research-report
{%- endblock %}


{% macro report_part(sections, is_appendix) %}
  {% for section in sections -%}
    <h2 class="report-header">
      <a
        id="{{ section.id }}"
        href="#{{ section.id }}">
          {{ ( 'Appendix ' if is_appendix else '' ) + section.numbering + section.title }}
      </a>
    </h2>

    {{ section.body | safe }}

    {% for subsection in section.children -%}
      <h3 class="report-header">
        <a
          id="{{ subsection.id }}"
          href="#{{ subsection.id }}">
            {{ subsection.numbering + subsection.title }}
        </a>
      </h3>

      {{ subsection.body | safe }}

      {% for section3 in subsection.children -%}
        <h4 class="report-header">
          <a
            id="{{ section3.id }}"
            href="#{{ section3.id }}">
              {{ section3.numbering + section3.title }}
          </a>
        </h4>

        {{ section3.body | safe }}
    {%- endfor %}
    {%- endfor %}
  {%- endfor %}
{% endmacro %}


{% block content_main %}
    <div class="block block__flush-top">
      <div class="eyebrow">{{ page.report_type }}</div>
      <h1>{{ page.page_header }}</h1>
      <div class="lead-paragraph">{{ page.subheader }}</div>
    </div>

    {{ report_part(report_sections) }}

    <h2 class="appendix-header">Additional Information</h2>

    <div class="block block__flush-top">
    </div>

    {% if page.sidefoot %}
        <aside class="o-prefooter">
            {{ streamfield_sidefoot.render(page.sidefoot, half_width=true) }}
        </aside>
    {% endif %}

{% endblock %}

{% block javascript scoped %}
    {{ super() }}
    <script async>
      if ( document.body.parentElement.className.indexOf( 'no-js' ) === -1 ) {
        !function(){
          {# Include site-wide JavaScript. #}
          var s = [
            '{{ static('apps/research-reports/js/index.js') }}',
          ];
          jsl(s);
        }()
      }
    </script>
{% endblock javascript %}
