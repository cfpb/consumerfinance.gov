{% extends "v1/layouts/layout-full.html" %}

{% from 'tccp/macros/data_published.html' import data_published %}
{% from 'tccp/macros/filter_form.html' import filter_form with context %}
{% import 'v1/includes/molecules/breadcrumbs.html' as breadcrumbs with context %}
{% import 'v1/includes/molecules/notification.html' as notification %}
{% from 'v1/includes/organisms/expandable.html' import expandable with context %}

{% block javascript scoped %}
{{ super() }}
<script src="{{ static( 'js/routes/on-demand/filterable-list-controls.js' ) }}"></script>
{% endblock %}

{% block content_main %}

<h1>Card search results</h1>

<p>
    Filter and sort the {{ total_count or "" }} cards in our database
    to find cards that have the features that fit your situation.
</p>

<div id="o-filterable-list-controls" class="o-filterable-list-controls">
    {% call() expandable({
        "label": "Customize results",
        "is_bordered": true,
        "is_expanded": true,
        "is_midtone": true
    }) %}
        {{ filter_form(form) }}
    {% endcall %}
</div>



<div class="block block__sub">
    <div class="o-filterable-list-results">

        {% if count -%}
        {{- notification.render(
            'success',
            true,
            count ~ ' result' ~ count | pluralize()
        ) -}}
        {%- else -%}
        {{- notification.render(
            'warning',
            true,
            'There are no results for your search.'
        ) -}}
        {%- endif %}

        <p>
            {% if first_report_date -%}
            {{ data_published(first_report_date) }}
            {%- endif %}
        </p>

        {%- set card_columns = [
            {'heading': 'Card'},
            {'heading': 'Purchase APR'},
            {'heading': 'Transfer APR'}
        ] %}
        {%- set card_rows = [] %}
        {%- for card in results %}
            {% do card_rows.append( [
                ('<a href="' ~ card.url ~ '">' ~ card.product_name ~ '</a>') | safe,
                card.purchase_apr,
                card.transfer_apr
            ] ) %}
        {% endfor %}
        {%- with value = {
            'data': {
                'columns': card_columns,
                'rows': card_rows
            },
            'options': ['is_stacked', 'stack_on_mobile']
        } %}
            {% include 'v1/includes/organisms/tables/base.html' %}
        {% endwith %}
    </div>
</div>

{% endblock content_main %}
