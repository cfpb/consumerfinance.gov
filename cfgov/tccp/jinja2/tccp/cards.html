{% extends "v1/layouts/layout-full.html" %}

{% from 'tccp/includes/filter_form.html' import filter_form with context %}
{% from 'v1/includes/organisms/expandable.html' import expandable with context %}

{% block title -%}
    {{ title }} | {{ super() }}
{%- endblock title %}

{% block javascript scoped %}
{{ super() }}
<script src="{{ static( 'js/routes/on-demand/filterable-list-controls.js' ) }}"></script>
<script src="{{ static( 'apps/tccp/js/index.js' ) }}"></script>
<script src="{{ static( 'apps/tccp/js/htmx.js' ) }}"></script>
{% endblock %}

{% block css %}
{{ super() }}
<link rel="stylesheet" href="{{ static('apps/tccp/css/main.css') }}">
{% endblock %}

{% block content_main_modifiers -%}
    {{ super() }} htmx-container
{%- endblock %}

{% block content_main %}

<div class="htmx-progress">
    <div class="htmx-progress-bar"></div>
</div>

<h1>{{ heading }}</h1>

<div class="block block__sub">
    {% set situations = form.cleaned_data.situations %}
    {% if not situations %}
        <p>
            Filter and sort the {{ stats_all.count or "" }} cards in our database
            to find cards that have the features that fit your situation.
        </p>
    {% else %}
        <h2>Youâ€™re looking to...</h2>

        {% for situation in situations %}
            <div class="block block__sub">
                <div class="o-well">
                    <h3>{{ situation.title }}</h3>

                    {{ situation.results_html }}
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

<div id="o-filterable-list-controls" class="o-filterable-list-controls">
    {% call() expandable({
        "label": "Customize results",
        "is_bordered": true,
        "is_expanded": not situations,
        "is_midtone": true
    }) %}
        {{ filter_form(form) }}
    {% endcall %}
</div>

<div class="block block__sub u-js-only" id="tccp-ordering-container"></div>

<div class="block block__sub">
    <div class="o-filterable-list-results o-filterable-list-results__partial htmx-results">
        {% include "tccp/includes/card_list.html" %}
    </div>
    <button data-js-hook="behavior_show-more" class="a-btn a-btn__link a-btn__warning a-btn__full-on-xs u-mt20 u-js-only">
        Show more results with higher interest rates
    </button>
</div>

{% endblock content_main %}
