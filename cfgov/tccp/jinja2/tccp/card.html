{% extends 'v1/layouts/layout-2-1.html' %}

{% from 'tccp/includes/apr_disclaimer.html' import apr_disclaimer with context %}
{% from 'tccp/includes/apr_table.html' import apr_table with context %}
{% from 'tccp/includes/fields.html' import apr, apr_range, currency, lower_first_letter, oxfordize %}
{% from 'tccp/includes/speed_bump.html' import speed_bump %}
{% from 'v1/includes/organisms/expandable.html' import expandable with context %}
{% import 'v1/includes/molecules/notification.html' as notification with context %}

{% block title -%}
    {{ card.institution_name }} {{ card.product_name }}
    | Consumer Financial Protection Bureau
{%- endblock title %}

{% block desc -%}
    Full interest rate and fee information for {{ card.product_name }} from {{ card.institution_name }}
{%- endblock desc %}

{% block og_desc -%}
    {{ self.desc() }}
{%- endblock og_desc %}

{% block og_image %}
    {%- include "tccp/includes/og_image.html" -%}
{% endblock %}

{% block javascript scoped %}
    {{ super() }}
    <script src="{{ static( 'js/routes/on-demand/expandable.js' ) }}"></script>
    <script src="{{ static( 'apps/tccp/js/index.js' ) }}"></script>
{% endblock %}

{% block css %}
    {{ super() }}
    <link rel="stylesheet" href="{{ static('apps/tccp/css/main.css') }}">
{% endblock %}

{% macro data_section(
    heading,
    heading_classes="h2 u-mb0",
    subheading_classes="h4 u-mt0"
) %}
<div
    {%- if heading_classes %} class="{{ heading_classes }}"{% endif -%}
>
    {{ caller() }}
    <span class="u-visually-hidden">{{ heading }}</span>
</div>
<div
    {%- if subheading_classes %} class="{{ subheading_classes }}"{% endif %}
    aria-hidden="true"
>
    {{- heading -}}
</div>
{% endmacro %}

{% block content_main %}
<div class="block block--flush-top">

    <div class="eyebrow">{{ card.institution_name }}</div>

    <h1>{{ card.product_name }}</h1>
    {% set tiers_description = 'This credit card is recommended for people with the following credit scores: ' %}
    {% set targeted_tiers = [] %}
    {% for tier_value, tier_name, _ in credit_tier_lookup %}
        {% if tier_value in card.targeted_credit_tiers %}
            {% do targeted_tiers.append(tier_name) %}
        {% endif %}
    {% endfor %}
    {% set tiers_description = tiers_description + oxfordize(targeted_tiers) %}
    <div class="o-card-details-section o-card-details-section--introduction">
        <div class="m-credit-tier-chart" role="figure">
            <p class="u-visually-hidden">{{ tiers_description }}</p>
            {% for tier_value, tier_name, _ in credit_tier_lookup %}
                {% if tier_value in card.targeted_credit_tiers %}
                    {% set targeted_tier = true %}
                {% else %}
                    {% set targeted_tier = false %}
                {% endif %}
                <div class="m-credit-tier-chart__tier m-credit-tier-chart__tier{{ '--selected' if targeted_tier else '--unselected' }}" aria-hidden="true">
                    <span class="m-credit-tier-chart__icon">
                        {%- if targeted_tier -%}
                            {{ svg_icon('approved-round') }}
                        {%- else -%}
                            &nbsp;
                        {%- endif -%}
                    </span>
                    <span class="m-credit-tier-chart__label">{{ tier_name }}</span>
                </div>
            {% endfor %}
        </div>
        <div class="h4 u-mt5" aria-hidden="true">
            Recommended credit scores
        </div>
        {% if card.availability_of_credit_card_plan == "One State/Territory" %}
            {% set availability = "single_state" %}
            {% set available_states = [card.state] %}
        {% elif card.availability_of_credit_card_plan == "Regional" %}
            {% set availability = "multiple_states" %}
            {% set available_states = card.state_multiple %}
        {% else %}
            {% set availability = "nationwide" %}
            {% set available_states = none %}
        {% endif %}
        <div class="{{ 'u-mt45' if availability == 'multiple_states' or card.requirements_for_opening else 'u-mt30 ' }} u-mb30">
            <div class="m-location-requirements">
                <div class="h2 u-mb0">
                    {% if availability == "nationwide" %}
                        Nationwide
                    {% elif availability == "single_state" %}
                        {{ state_lookup[available_states[0]] ~ ' only' }}
                    {% elif availability == "multiple_states" and not card.pertains_to_specific_counties %}
                        State-by-state
                    {% else %}
                        County-by-county
                    {% endif %}
                </div>
                <div class="h4 u-mt0">
                    Availability
                </div>
            </div>
            {% if availability == "multiple_states" or card.geographic_restrictions is not none %}
                <ul>
                    {% if availability == "multiple_states" %}
                        <li>
                            To apply, you must live in
                            {{ 'certain counties in ' if card.pertains_to_specific_counties }}
                            {%- set states = [] -%}
                            {%- for state in available_states -%}
                                {%- do states.append(state_lookup[state]) -%}
                            {%- endfor -%}
                            {{ oxfordize(states) }}
                        </li>
                    {% endif %}
                    {% if card.geographic_restrictions is not none %}
                        <li>{{ card.geographic_restrictions }}</li>
                    {% endif %}
                </ul>
            {% endif %}
            {% if
                card.professional_affiliation is not none
                or card.other is not none
                or card.issued_by_credit_union
            %}
                <div class="h4 u-mt15">Eligibility requirements</div>
                <ul>
                    {% for requirement in [
                        card.professional_affiliation,
                        card.other
                    ] %}
                        {% if requirement %}
                            <li>{{ requirement }}</li>
                        {% endif %}
                    {% endfor %}
                    {% if card.issued_by_credit_union -%}
                    <li>
                        This card is from a credit union, a not-for-profit, member-owned
                        institution that you must join before applying for the card.
                        Check with the credit union for membership requirements, which
                        typically include living in certain areas or working for certain
                        employers.
                    </li>
                    {%- endif %}
                </ul>
            {% endif %}
        </div>

        <h2>Review details with the company before applying</h2>
        <p>
            APRs change over time and are specific to the applicant.
            Check rates before applying.
        </p>
        {{ render_contact_info(card) }}

        {% if not card.issued_by_top_25_institution %}
            <div class="u-mt30">
                {{ speed_bump( {
                    'content': (
                        'This card is from a ' ~
                        ['small bank', 'credit union'][card.issued_by_credit_union] ~
                        ', which often offer lower interest rates ' ~
                        'and could save you hundreds of dollars per year.'
                    )
                } ) }}
            </div>
        {% endif %}
    </div>

    {% if card.secured_card %}
        <div class="u-mt30 u-mb30">
            {{ notification.render(
                "warning",
                true,
                "This is a secured card",
                "You may have to pay a security deposit to open and use this
                card and will only be able to make purchases or get cash
                advances up to the amount of that deposit."
            ) }}
        </div>
    {% endif %}

    <div class="o-card-details-section">
        <h2>
            {{ svg_icon("cart-round") }}
            Purchase interest rate and fees
        </h2>
        {% if card.purchase_apr_offered and not card.purchase_apr_data_incomplete %}
            {# How top-line APR displays if the card has:
                - Min and max APRs: "19.49% - 31.99% purchase APR"
                - No min and max but a median: "29.74% median purchase APR"
                - Single APR for everyone: "24.90% purchase APR"
            #}
            {% if card.purchase_apr_min is not none
                and card.purchase_apr_max is not none
            %}
                {% set purchase_apr_term = 'Purchase APR' %}
            {% elif card.purchase_apr_median is not none %}
                {% set purchase_apr_term = 'Median purchase APR' %}
            {% endif %}
            {% call data_section(purchase_apr_term) %}
                {% if card.purchase_apr_min is not none
                    and card.purchase_apr_max is not none
                %}
                    {{ apr_range(card.purchase_apr_min, card.purchase_apr_max) }}*
                {% elif card.purchase_apr_median is not none %}
                    {{ apr(card.purchase_apr_median) }}*
                {% endif %}
            {% endcall %}
            {{ apr_disclaimer(card.report_date,
                "purchase",
                card.purchase_apr_vary_by_credit_tier
            ) }}
            <p>
                Here are typical APRs for different credit scores for this card:
            </p>

            {{ apr_table(card, "purchase", show_comparison=true) }}

            <p>
                After opening the credit card, the purchase APR is
                {% if 'V' in card.index %}
                    variable, meaning it can go up or down based on the index
                    listed in the details below.
                {% else %}
                    fixed, meaning it will not go up or down with changes to
                    an index, but it may still change.
                {% endif %}
                Learn more about
                <a href="/ask-cfpb/what-is-a-credit-card-interest-rate-what-does-apr-mean-en-44/">APRs in general</a>
                and about
                <a href="/ask-cfpb/what-is-the-difference-between-a-fixed-apr-and-a-variable-apr-en-45/">fixed versus variable APRs</a>.
            </p>
        {% elif card.purchase_apr_offered and card.purchase_apr_data_incomplete %}
            <p>The company did not submit information about purchase APR.</p>
        {% else %}
            <p>This card does not charge interest on purchases.</p>
        {% endif %}
        {% if card.introductory_apr_offered %}
            {% if card.intro_apr_min is not none
                and card.intro_apr_max is not none
            %}
                {% set introductory_apr_term = 'Introductory APR' %}
            {% elif card.intro_apr_median is not none %}
                {% set introductory_apr_term = 'Median introductory APR' %}
            {% endif %}
            {% call data_section(
                introductory_apr_term,
                heading_classes="h3 u-mb0 u-mt30",
                subheading_classes="u-mb15"
            ) %}
                {% if card.intro_apr_min is not none
                    and card.intro_apr_max is not none
                %}
                    {{ apr_range(card.intro_apr_min, card.intro_apr_max) }}
                {% elif card.intro_apr_median is not none %}
                    {{ apr(card.intro_apr_median) }}
                {% endif %}
                for
                {{ '%.0f' | format(card.median_length_of_introductory_apr ) }}
                months
            {% endcall %}
            {% if card.introductory_apr_vary_by_credit_tier %}
                <p>
                    Your introductory APR will vary based on your credit score.
                    Here are typical introductory APRs for different credit scores
                    for this card:
                </p>

                {{ apr_table(card, "intro") }}
            {% elif card.intro_apr_median is not none
                and card.intro_apr_min != card.intro_apr_max %}
                <p>
                    The median introductory APR for this card is
                    {{ apr(card.intro_apr_median) }}.
                </p>
            {% endif %}
            <p>
                If a card has promotional interest, ensure you’re on track to
                pay off the balance within the promotional period, or you could
                end up owing more in interest than the original purchase amount.
                <a href="/ask-cfpb/i-got-a-credit-card-promising-no-interest-for-a-purchase-if-i-pay-in-full-within-12-months-how-does-this-work-en-40/">Learn more about introductory APR offers</a>.
            </p>
        {% endif %}
        <div class="o-additional-details">
            {% call() expandable({
                'label': 'Foreign transaction fee, grace period, and other details',
                'is_bordered': true,
                'is_expanded': false,
                'is_midtone': true
            }) %}
                <dl class="m-list m-list__card-details">
                    <dt>Foreign transaction fee</dt>
                    <dd>
                        {# How foreign transaction fees display:
                            - No fee: "None"
                            - Dollar amount: "$3"
                            - Percentage: "3.00%"
                            - Calculation: "Whatever text was submitted"
                            - With minimum fee amount: add "($0.50 minimum)" to end
                            - Dollar or percentage and calculation: "3.00% (text)"
                        #}
                        {% if card.foreign_transaction_fees %}
                            {{ currency(card.foreign_transaction_fee_dollars) ~
                                ' per purchase' if card.foreign_transaction_fee_dollars
                                is not none
                            }}
                            {{ apr(card.foreign_transaction_fee_percentage) ~
                                ' of each purchase' if
                                card.foreign_transaction_fee_percentage is not none
                            -}}
                            {% if card.minimum_foreign_transaction_fee_amount is not none %}
                                {{ '(' ~ currency(card.minimum_foreign_transaction_fee_amount)
                                    ~ ' minimum)' if card.minimum_foreign_transaction_fee_amount
                                    is not none
                                }}
                            {%- endif %}
                            {%- if card.foreign_transaction_fee_calculation %}
                                {{- '; ' if card.foreign_transaction_fee_dollars is not none
                                    or card.foreign_transaction_fee_percentage is not none
                                -}}
                                {{- card.foreign_transaction_fee_calculation -}}
                            {% endif %}
                        {% else %}
                            None
                        {% endif %}
                    </dd>
                    <dt>Minimum finance charge</dt>
                    <dd>
                        {% if card.minimum_finance_charge %}
                            A minimum interest payment of
                            {{ currency(card.minimum_finance_charge_dollars) }}
                            is required to avoid additional fees
                        {% else %}
                            No minimum interest payment is required to avoid additional
                            fees
                        {% endif %}
                    </dd>
                    <dt>Grace period</dt>
                    <dd>
                        {{ card.grace_period ~ ' days until interest begins to accrue on
                            purchases' if card.grace_period_offered else 'None, interest
                            begins accruing on purchases immediately'
                        }}
                    </dd>
                    <dt>Balance computation method</dt>
                    <dd>
                        {% if 'Other' is not in card.balance_computation_method %}
                            Monthly interest is calculated based on your
                            {{ lower_first_letter(card.balance_computation_method | join) }}
                        {% else %}
                            {{ card.balance_computation_method_details }}
                        {% endif %}
                    </dd>
                    {# No cards in the June 2023 data have this fee, so we'll handle it
                        with a very simple yes/no to future-proof it just in case #}
                    {% if card.purchase_transaction_fees %}
                        <dt>Purchase transaction fee</dt>
                        <dd>Yes</dd>
                    {% endif %}
                    {% if card.purchase_apr_index %}
                        <dt>Purchase APR index</dt>
                        <dd>
                            The purchase APR varies depending on the value of the
                            {{ lower_first_letter(card.variable_rate_index | join) }}
                            index
                        </dd>
                    {% endif %}
                </dl>
                <p>
                    <a href="/ask-cfpb/how-does-my-credit-card-company-calculate-the-amount-of-interest-i-owe-en-51/">Learn more about how credit card interest is calculated</a>.
                </p>
            {% endcall %}
        </div>
    </div>

    <div class="o-card-details-section">
        <h2>
            {{ svg_icon("credit-payment-round") }}
            Fees
        </h2>
        {# How top-line fee displays if the card has:
            - Annual fee: "$95 annual fee"
            - Monthly fee: "$8.25 monthly fee"
            - Annual and monthly fee: "$175 annual fee + $12.50 monthly fee"
            - Other fee: "$50 {fee name, period}"
            - Annual and other fee: "$495 annual fee + $50 {fee name, period}"
            - No periodic fee: "$0 annual fee"
        #}
        <div class="m-payment-calculation u-mb15">
            {% if card.annual_fee %}
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        'Annual fee',
                        heading_classes="h2 u-mb0 u-mt0",
                        subheading_classes="h4 u-mt0 u-mb0"
                    ) %}
                        {{ currency(card.annual_fee) }}
                    {% endcall %}
                </div>
            {% endif %}
            {% if card.monthly_fee %}
                {% if card.annual_fee %}
                    <div class="m-payment-calculation__operator h2">+</div>
                {% endif %}
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        'Monthly fee',
                        heading_classes="h2 u-mb0 u-mt0",
                        subheading_classes="h4 u-mt0 u-mb0"
                    ) %}
                        {{ currency(card.monthly_fee) }}
                    {% endcall %}
                </div>
            {% endif %}
            {% if card.weekly_fee %}
                {% if card.annual_fee or card.monthly_fee %}
                    <div class="m-payment-calculation__operator h2">+</div>
                {% endif %}
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        'Weekly fee',
                        heading_classes="h2 u-mb0 u-mt0",
                        subheading_classes="h4 u-mt0 u-mb0"
                    ) %}
                        {{ currency(card.weekly_fee) }}
                    {% endcall %}
                </div>
            {% endif %}
            {% if card.other_periodic_fee_amount %}
                {% if
                    card.annual_fee
                    or card.monthly_fee
                    or card.weekly_fee
                %}
                    <div class="m-payment-calculation__operator h2">+</div>
                {% endif %}
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        (card.other_periodic_fee_name | capitalize) ~
                        ', ' ~
                        (card.other_periodic_fee_frequency | lower),
                        heading_classes="h2 u-mb0 u-mt0",
                        subheading_classes="h4 u-mt0 u-mb0"
                    ) %}
                        {{ currency(card.other_periodic_fee_amount) }}
                    {% endcall %}
                </div>
            {% endif %}
            {% if not card.annual_fee
                and not card.monthly_fee
                and not card.weekly_fee
                and not card.other_periodic_fee_amount
            %}
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        'Annual fee',
                        heading_classes="h2 u-mb0 u-mt0",
                        subheading_classes="h4 u-mt0 u-mb0"
                    ) %}
                        {{ currency(0) }}
                    {% endcall %}
                </div>
            {% endif %}
        </div>
        {% if card.fee_explanation is not none %}
            <p>{{ card.fee_explanation }}</p>
        {% endif %}
        <div class="o-additional-details">
            {% set other_fees = [] %}
            {% for i in range(5) %}
                {% set loop_suffix = ('_' ~ (i + 1)) if i else '' %}
                {% set other_fee_name = card['other_fee_name' ~ loop_suffix] %}
                {% if other_fee_name %}
                    {% do other_fees.append({
                        "name": other_fee_name,
                        "amount": card['other_fee_amount' ~ loop_suffix],
                        "explanation": card['other_fee_explanation' ~ loop_suffix]
                    }) %}
                {% endif %}
            {% endfor %}

            {% if other_fees %}
                {% set other_fees_label = (
                    'Late, over-limit, and '
                    ~ other_fees | length
                    ~ ' other fee'
                    ~ ('s' if other_fees | length > 1)
                ) %}
            {% else %}
                {% set other_fees_label = 'Late and over-limit fees' %}
            {% endif %}
            {% call() expandable({
                'label': other_fees_label,
                'is_bordered': true,
                'is_expanded': false,
                'is_midtone': true
            }) %}
                <dl class="m-list m-list__card-details">
                    <dt>Late fee</dt>
                    <dd>
                        {% if card.late_fees %}
                            {{ currency(card.late_fee_dollars) ~ ' for the first late payment' if
                                card.late_fee_dollars
                            }}
                            {{ 'and' if card.late_fee_dollars
                                and card.late_fee_six_month_billing_cycle
                            }}
                            {{ currency(card.late_fee_six_month_billing_cycle) ~
                                ' for a late payment within six billing cycles of another
                                late payment' if card.late_fee_six_month_billing_cycle
                            }}
                            {#
                                A handful of cards specify neither a first nor repeat
                                late fee and put all late fee info in the
                                late_fee_policy_details field. For cards like that,
                                we'll show the details here and not show the "Late fee
                                policy details" item.
                            #}
                            {{
                                card.late_fee_policy_details
                                if card.has_only_variable_late_fees
                            }}
                        {% else %}
                            None
                        {% endif %}
                    </dd>
                    {#
                        See the comment above: we won't show this if we're already
                        showing late fee details in the "Late fee" item, i.e. if the
                        card has *only* policy details chosen in late_fee_types.
                    #}
                    {% if card.late_fee_policy_details
                        and not card.has_only_variable_late_fees
                    %}
                        <dt>Late fee policy details</dt>
                        <dd>{{ card.late_fee_policy_details }}</dd>
                    {% endif %}
                    <dt>Over-limit fee</dt>
                    <dd>
                        {% if card.over_limit_fees %}
                            {{ currency(card.over_limit_fee_dollars) if
                                card.over_limit_fee_dollars
                            }}
                            {#
                                A handful of cards specify only over-limit fee details
                                and not a fixed dollar amount. For cards like that,
                                we'll show the details here and not show the
                                "Over-limit fee details."
                            #}
                            {{
                                card.overlimit_fee_detail
                                if card.has_only_variable_over_limit_fees
                            }}
                        {% else %}
                            None
                        {% endif %}
                    </dd>
                    {#
                        See the comment above: we won't show this if we're already
                        showing over-limit fee details in the "Over-limit fee" item,
                        i.e. if the card has *only* details chosen in
                        over_limit_fee_types.
                    #}
                    {% if card.overlimit_fee_detail
                        and not card.has_only_variable_over_limit_fees
                    %}
                        <dt>Over-limit fee details</dt>
                        <dd>{{ card.overlimit_fee_detail }}</dd>
                    {% endif %}
                    {% for other_fee in other_fees %}
                        <dt>{{ other_fee.name }}</dt>
                        <dd>
                            {{-
                                currency(other_fee.amount)
                                ~ ' ('
                                ~ other_fee.explanation
                                ~ ')'
                            -}}
                        </dd>
                    {% endfor %}
                </dl>
            {% endcall %}
        </div>
    </div>

    <div class="o-card-details-section">
        <h2>
            {{ svg_icon("gift-round") }}
            Rewards and perks
        </h2>
        {% if card.rewards %}
            {% call data_section('Rewards') %}
                {%- set rewards = [] -%}
                {%- for reward in card.rewards -%}
                    {%- do rewards.append(rewards_lookup[reward]) -%}
                {%- endfor -%}
                {{ oxfordize(rewards) | capitalize }}
            {% endcall %}
        {% else %}
            <p>This card does not offer cash back, travel, or other rewards.</p>
        {% endif %}
        {% if card.other_rewards %}
            <p>Other rewards: {{ card.other_rewards }}</p>
        {% endif %}
        <div class="o-additional-details">
            {% call() expandable({
                'label': 'Card services and features',
                'is_bordered': true,
                'is_expanded': false,
                'is_midtone': true
            }) %}
                <dl class="m-list m-list__card-details">
                    {% if card.services %}
                        <dt>Services</dt>
                        <dd>
                            <ul>
                                {% for service in card.services %}
                                    <li>
                                        {{ service if service != 'Other' else
                                            card.other_services
                                        }}
                                    </li>
                                {% endfor %}
                            </ul>
                        </dd>
                    {% endif %}
                    {% if card.card_features %}
                        <dt>Card features</dt>
                        <dd>
                            <ul>
                                {% for feature in card.card_features %}
                                    <li>
                                        {{ feature if feature != 'Other' else
                                            card.other_card_features
                                        }}
                                    </li>
                                {% endfor %}
                            </ul>
                        </dd>
                    {% endif %}
                </dl>
            {% endcall %}
        </div>
        {% if card.rewards %}
            <div class="u-mt30">
                {{ speed_bump( {
                    'content': 'If you carry a balance on your credit card, interest and
                        fees typically exceed the value of any rewards earned.',
                    'link': 'Learn why rewards may not be as beneficial as they seem.',
                    'url': '/about-us/newsroom/cfpb-report-highlights-consumer-frustrations-with-credit-card-rewards-programs/'
                } ) }}
            </div>
        {% endif %}
    </div>

    <div class="o-card-details-section">
        <h2>
            {{ svg_icon("money-transfer-round") }}
            Balance transfer interest rate and fees
        </h2>
        {# How top-line transfer APR and fees display if the card has:
            - One APR: "1.99% balance transfer APR"
            - Range of APRs: "12.99% - 17.90% balance transfer APR"
            - No transfer fee: "$0 balance transfer fee"
            - Dollar transfer fee: "$5 balance transfer fee"
            - Percentage transfer fee: "3.00% balance transfer fee"
            - Dollar and percentage fee: "$5 or 5.00% balance transfer fee"
            - Custom transfer fee: "Variable transfer fee"
            - Minimum transfer fee: "($5 minimum)" added at the end
        #}
        {% if card.balance_transfer_offered %}
            {% if card.transfer_apr_min is not none
                and card.transfer_apr_max is not none
            %}
                {% set balance_transfer_apr_term = 'Balance transfer APR' %}
            {% elif card.transfer_apr_median is not none %}
                {% set balance_transfer_apr_term = 'Median balance transfer APR' %}
            {% endif %}
            <div class="m-payment-calculation u-mb15">
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        balance_transfer_apr_term ~
                        (' for ' ~
                        '%.0f' | format(card.median_length_of_balance_transfer_apr) ~
                        ' months' if card.median_length_of_balance_transfer_apr is not none)
                    ) %}
                        {% if card.transfer_apr_min is not none
                            and card.transfer_apr_max is not none
                        %}
                            {{ apr_range(card.transfer_apr_min, card.transfer_apr_max) }}*
                        {% elif card.transfer_apr_median is not none %}
                            {{ apr(card.transfer_apr_median) }}*
                        {% endif %}
                    {% endcall %}
                </div>
                <div class="m-payment-calculation__operator h2">+</div>
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        'Balance transfer fee'
                        ~ (', see details' if card.balance_transfer_fee_calculation)
                    )%}
                        {{ currency(card.balance_transfer_fee_dollars) if
                            card.balance_transfer_fee_dollars is not none
                        }}
                        {# TODO: Is this an "or"? Or can it be an "and"? #}
                        {{ ' or ' if card.balance_transfer_fee_dollars is not none
                            and card.balance_transfer_fee_percentage is not none
                        }}
                        {{ apr(card.balance_transfer_fee_percentage) if
                            card.balance_transfer_fee_percentage is not none
                        }}
                        {{ '(' ~ currency(card.minimum_balance_transfer_fee_amount) ~
                            ' minimum)' if card.minimum_balance_transfer_fee_amount
                            is not none
                        }}
                        {{ 'Variable' if card.balance_transfer_fee_calculation
                            and card.balance_transfer_fee_dollars is none
                            and card.balance_transfer_fee_percentage is none
                        }}
                        {{ currency(0) if not card.balance_transfer_fees }}
                     {% endcall %}
                </div>
            </div>
            {% if card.balance_transfer_fee_calculation %}
                <p>
                    Balance transfer fee details:
                    {{ card.balance_transfer_fee_calculation }}
                </p>
            {% endif %}
            {{ apr_disclaimer(card.report_date,
                "balance transfer",
                card.balance_transfer_apr_vary_by_credit_tier
            ) }}
            {% if card.balance_transfer_apr_vary_by_credit_tier %}
                <p>
                    Here are typical balance transfer APRs for different
                    credit scores for this card:
                </p>

                {{ apr_table(card, "transfer", apr_label="balance transfer") }}
            {% elif card.transfer_apr_median is not none
                and card.transfer_apr_min != card.transfer_apr_max %}
                <p>
                    The median balance transfer APR for this card is
                    {{ apr(card.transfer_apr_median) }}.
                </p>
            {% endif %}
            <p>
                {%- if card.median_length_of_balance_transfer_apr is not none -%}
                    After
                    {{ '%.0f' | format(card.median_length_of_balance_transfer_apr ) }}
                    months, a
                {%- else -%}
                    A
                {%- endif -%}
                ny remaining unpaid balance on your account will be
                subject to interest charges based on your purchase APR.
            </p>
        {% else %}
            <p>This card does not offer balance transfers.</p>
        {% endif %}
    </div>

    <div class="o-card-details-section">
        <h2>
            {{ svg_icon("quick-cash-round") }}
            Cash advance interest rate and fees
        </h2>
        {% if card.cash_advance_apr_offered %}
            {% if card.advance_apr_min is not none
                and card.advance_apr_max is not none
            %}
                {% set cash_advance_apr_term = 'Cash advance APR' %}
            {% elif card.advance_apr_median is not none %}
                {% set cash_advance_apr_term = 'Median cash advance APR' %}
            {% else %}
                {% set cash_advance_apr_term = 'Cash advance APR' %}
            {% endif %}
            <div class="m-payment-calculation u-mb15">
                <div class="m-payment-calculation__part">
                    {% call data_section(cash_advance_apr_term) %}
                        {% if card.advance_apr_min is not none
                            and card.advance_apr_max is not none
                        %}
                            {{ apr_range(card.advance_apr_min, card.advance_apr_max) }}*
                        {% elif card.advance_apr_median is not none %}
                            {{ apr(card.advance_apr_median) }}*
                        {% else %}
                            N/A
                        {% endif %}
                    {% endcall %}
                </div>
                <div class="m-payment-calculation__operator h2">+</div>
                <div class="m-payment-calculation__part">
                    {% call data_section(
                        'Cash advance fee'
                        ~ (', see details' if card.cash_advance_fee_calculation)
                    ) %}
                        {{ currency(card.cash_advance_fee_dollars) if
                            card.cash_advance_fee_dollars is not none
                        }}
                        {# TODO: Is this an "or"? Or can it be an "and"? #}
                        {{ ' or ' if card.cash_advance_fee_dollars is not none
                            and card.cash_advance_fee_percentage is not none
                        }}
                        {{ apr(card.cash_advance_fee_percentage) if
                            card.cash_advance_fee_percentage is not none
                        }}
                        {{ '(' ~ currency(card.minimum_cash_advance_fee_amount) ~
                            ' minimum)' if card.minimum_cash_advance_fee_amount
                            is not none
                        }}
                        {{ 'Variable' if card.cash_advance_fee_calculation
                            and card.cash_advance_fee_dollars is none
                            and card.cash_advance_fee_percentage is none
                        }}
                        {{ currency(0) if not card.cash_advance_fees }}
                    {% endcall %}
                </div>
            </div>
            {% if card.cash_advance_fee_calculation %}
                <p>
                    Cash advance fee details:
                    {{ card.cash_advance_fee_calculation }}
                </p>
            {% endif %}
            {{ apr_disclaimer(card.report_date,
                "cash advance",
                card.cash_advance_apr_vary_by_credit_tier
            ) }}
            {% if card.cash_advance_apr_vary_by_credit_tier %}
                <p>
                    Here are typical cash advance APRs for different credit
                    scores for this card:
                </p>

                {{ apr_table(card, "advance", apr_label="cash advance") }}
            {% elif card.advance_apr_median is not none
                and card.advance_apr_min != card.advance_apr_max %}
                <p>
                    The median cash advance APR for this card is
                    {{ apr(card.advance_apr_median) }}.
                </p>
            {% endif %}
            {% if card.cash_advance_fee_for_each_transaction %}
                <p>
                    The cash advance fee is charged for each cash advance.
                </p>
            {% endif %}
        {% else %}
            <p>This card does not offer cash advances.</p>
        {% endif %}
    </div>
    {% if card.balance_transfer_offered or card.cash_advance_apr_offered %}
        <div class="o-card-details-section">
            {{ speed_bump( {
                'content': 'If you use your card to transfer a balance or get a
                    cash advance, you may have to start paying interest on some
                    or all of your total balance, including new purchases,
                    as of the date of the transaction.'
            } ) }}
        </div>
    {% endif %}

</div>

{% endblock content_main %}

{% block content_sidebar %}
    {%- include "tccp/includes/sidebar.html" -%}
{% endblock content_sidebar %}
