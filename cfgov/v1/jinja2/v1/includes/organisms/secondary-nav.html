{# ==========================================================================

   secondary_nav.render()

   ==========================================================================

   Description:

   Creates markup for Secondary Navigation organism.

   ========================================================================== #}

{% macro render() %}
{%- set nav_items = page.get_secondary_nav_items( request ) -%}

{%- set any_children = nav_items | map( attribute="children" ) | reject( "undefined" ) | list -%}

<nav class="o-secondary-nav
            {{ '' if any_children else 'o-secondary-nav__no-children' }}"
     aria-label="{{ _('Section navigation') }}">

    <button class="o-secondary-nav_header" type="button" aria-expanded="false">
        <span class="o-secondary-nav_label">
            In this section
        </span>
        <span class="o-secondary-nav_cues">
            <span class="o-secondary-nav_cue-open" aria-label="Show">
                <svg xmlns="http://www.w3.org/2000/svg" class="cf-icon-svg cf-icon-svg__plus-round" viewBox="0 0 17 20.4"><path d="M16.416 10.283A7.917 7.917 0 1 1 8.5 2.366a7.916 7.916 0 0 1 7.916 7.917zm-2.958.01a.792.792 0 0 0-.792-.792H9.284V6.12a.792.792 0 1 0-1.583 0V9.5H4.32a.792.792 0 0 0 0 1.584H7.7v3.382a.792.792 0 0 0 1.583 0v-3.382h3.382a.792.792 0 0 0 .792-.791z"></path></svg>
            </span>
            <span class="o-secondary-nav_cue-close" aria-label="Hide">
                <svg xmlns="http://www.w3.org/2000/svg" class="cf-icon-svg cf-icon-svg__minus-round" viewBox="0 0 17 20.4"><path d="M16.416 10.283A7.917 7.917 0 1 1 8.5 2.366a7.916 7.916 0 0 1 7.916 7.917zm-2.958.01a.792.792 0 0 0-.792-.792H4.32a.792.792 0 0 0 0 1.583h8.346a.792.792 0 0 0 .792-.791z"></path></svg>
            </span>
        </span>
    </button>

    <div class="o-secondary-nav_content">
        <ul class="o-secondary-nav_list
                   o-secondary-nav_list__parents">
        {%- for item in nav_items %}
            <li data-nav-is-active="{{ item.expanded }}">
                {{ _navlink(item.title, item.url, true, item.active) }}
            {%- if item.children -%}
                <ul class="o-secondary-nav_list
                           o-secondary-nav_list__children">
                {%- for child in item.children -%}
                    <li>
                        {{ _navlink(child.title, child.url, false, child.active) }}
                    </li>
                {%- endfor %}
                </ul>
            {%- endif -%}
            </li>
        {%- endfor %}
        </ul>
    </div>
</nav>
{% endmacro %}

{% macro _navlink(text, href, parent=true, current=false) %}
<a class="o-secondary-nav_link
          {{ 'o-secondary-nav_link__parent' if parent else '' }}
          {{ 'o-secondary-nav_link__current' if current else '' }}"
   {{ 'href=' ~ href | e if not current else '' }}>
    {{ text | e }}
</a>
{% endmacro %}
