{% extends 'layout-2-1-bleedbar.html' %}

{% block css -%}
    {{ super() }}
    <link rel="stylesheet" href="{{ static('apps/agreements/css/main.css') }}">
{%- endblock css %}

{% block hero %}
<div class="wrapper content_wrapper">

    {%- import 'molecules/breadcrumbs.html' as breadcrumbs with context -%}
    {% set breadcrumb_items = [{
        'href': '/prepaid-agreements/',
        'title': 'Prepaid Product Agreements Database'
    }]%}
    {{ breadcrumbs.render(breadcrumb_items) }}
</div>
{% endblock %}

{% block content_main_modifiers -%}
    {{ super() }} content__flush-bottom prepaid-detail
{%- endblock %}

{% block content_main %}

{% set default_text = 'No information provided' %}
<h1>{{ product.name }}</h1>
<div class="content-l">
        <div class="content-l_col content-l_col-1-2">
            <dl>
                <dt><h2>Issuer name</h2></dt>
                <dd>{{ product.issuer_name | lower | title }}</dd>
                <dt><h2>Prepaid account type</h2></dt>
                <dd>{{ product.prepaid_type if product.prepaid_type else default_text }}</dd>
            </dl>
        </div>
        <div class="content-l_col content-l_col-1-2">
            <dl>
                <dt><h2>Program manager name</h2></dt>
                <dd>{{ product.program_manager if product.program_manager else default_text }}</dd>
                <dt><h2>Current status</h2></dt>
                <dd>{{ product.status if product.status else default_text }}</dd>
            </dl>
        </div>
    </div>
        <dl>
            <dt><h2>Other relevant parties</h2></dt>
            <dd>{{ product.other_relevant_parties if product.other_relevant_parties else default_text }}</dd> 
        </dl>

{% set agreements = product.prepaidagreement_set.order_by('-effective_date') %}
{% if agreements | length %}

    <div class="block u-mt45">
        <h2 class="h3"> Download most recent agreement files</h2>
        {% set agreement = agreements | first  %}
        <div class="block block__sub block__flush-top">
            <p class="agreement-effective-date"><span>Agreement effective date:</span> {{ agreement.effective_date }}</p>
            <p class="break-word">
                <a href="{{ s3_path }}{{ agreement.agreements_files_location }}">
                    {{ agreement.agreements_files_location }}
                </a>
            </p>
        </div>
    </div>

    {% if agreements | length > 1 %}
    <div class="block u-mt45">
        <h2 class="h3"> Download older agreements</h2>
        {% for agreement in agreements[1:] %}
            <div class="block block__sub {{ 'block__flush-top' if loop.index == 1 else '' }}">
                <p class="agreement-effective-date"><span>Agreement effective date:</span> {{ agreement.effective_date }}</p>
                <p class="break-word">
                    <a href="{{ s3_path }}{{ agreement.agreements_files_location }}">
                        {{ agreement.agreements_files_location }}
                    </a>
                </p>
            </div>
        {% endfor %}
    </div>
    {% endif %}
{% endif %}

{% endblock %}

{% block content_sidebar_modifiers -%}
    o-sidebar-content
{%- endblock %}

{% block content_sidebar scoped -%}
<header class="m-slug-header">
  <h2 class="a-heading">
      More on the prepaid account agreement database
  </h2>
</header>
{{ disclaimer.text | safe }}
{%- endblock %}
