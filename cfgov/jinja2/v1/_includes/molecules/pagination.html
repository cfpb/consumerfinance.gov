
{# ==========================================================================

   pagination.render()

   ==========================================================================

   Description:

   Builds pagination markup when given:

   total_pages: Total number of pages.

   curr_page:   Currently selected page (out of the total).

   is_stepper:  Whether the pagination is a stepper, meaning the user can not
                jump to a page, but must sequentially work through the pages.
                Default is false.

   fragment_id: The fragment identifier attached
                to the prev/next pagination buttons.
                Default is empty string.

   index:       A unique number given to render the form and its fields with.
                Default is 0.

   ========================================================================== #}

{% macro render(total_pages, curr_page, is_stepper=false, fragment_id='', index=0) %}
{% if total_pages > 1 and curr_page <= total_pages %}
{% from 'macros/util/url_parameters.html' import url_parameters %}
{% set fragment_id = '#' + fragment_id if fragment_id else '' %}
    <nav class="m-pagination"
         role="navigation"
         aria-label="Pagination">
        {%- if curr_page > 1 %}
        <a class="btn
                  btn__super
                  m-pagination_btn-prev"
           href="?page={{ (curr_page - 1) ~ url_parameters(request.GET) ~ fragment_id }}">
        {% else %}
        <a class="btn btn__super
                  btn__disabled
                  m-pagination_btn-prev">
        {% endif -%}
            <span class="btn_icon__left
                         cf-icon
                         cf-icon-left"></span>
            {%- if is_stepper %}
            Previous
            {% else %}
            Newer
            {% endif -%}
        </a>
        {%- if curr_page < total_pages %}
        <a class="btn
                  btn__super
                  m-pagination_btn-next"
           href="?page={{ (curr_page + 1) ~ url_parameters(request.GET) ~ fragment_id }}">
        {%- else %}
        <a class="btn
                  btn__super
                  btn__disabled
                  m-pagination_btn-next">
        {% endif -%}
            {%- if is_stepper %}
            Next
            {% else %}
            Older
            {% endif -%}
            <span class="btn_icon__right
                         cf-icon
                         cf-icon-right"></span>
        </a>
        <form action="{{ fragment_id }}">
            {%- if not is_stepper %}
            <label for="m-pagination_current-page-{{ index | string }}">
            {% endif -%}
                <span class="m-pagination_label">
                    {{ 'Step' if is_stepper else 'Page' }}
                </span>
                <span class="u-visually-hidden">
                    {{ curr_page }} out of {{ total_pages }} total {{ 'steps' if is_stepper else 'pages' }}
                </span>
            {%- if is_stepper %}
            <span class="m-pagination_label">
                {{ curr_page }}
            </span>
            {% else %}
            </label>
            {% for (key, value) in request.GET.items() %}
                {% if value != '' %}
                    <input type="hidden"
                           name="{{ key }}"
                           value="{{ value }}">
                {% endif %}
            {% endfor %}
            <input id="m-pagination_current-page-{{ index | string }}"
                   class="m-pagination_current-page"
                   name="page"
                   type="number"
                   min="1"
                   max="{{ total_pages }}"
                   pattern="[0-9]*"
                   inputmode="numeric"
                   value="{{ curr_page }}">
            {% endif -%}
            <span class="m-pagination_label">
                of {{ total_pages }}
            </span>
            {%- if not is_stepper %}
            <button class="btn
                           btn__link
                           m-pagination_submit-btn"
                    type="submit">
                Go
            </button>
            {% endif -%}
        </form>
    </nav>
{% endif %}
{% endmacro %}
