{# ==========================================================================

   sidenav_toc.render()

   ==========================================================================

   Description:

   Creates markup for sidenav table of contents

   ========================================================================== #}

{% macro render() %}
  {{ _render_secondary_navigation() }}
{% endmacro %}

{# ==========================================================================

   _render_secondary_navigation()

   ========================================================================== #}
{% macro _render_secondary_navigation() %}

<nav class="o-report-sidenav o-secondary-navigation"
     aria-label="Section navigation">
      {% import 'molecules/nav-link.html' as nav_link %}

      {% set sec_nav_settings = {
        'label': _('Table of contents'),
        'is_midtone': true,
        'is_bordered': false,
        'is_expanded': false
      } %}
      {% from 'organisms/expandable.html' import expandable with context %}
      {% call() expandable(sec_nav_settings) %}
        {% import 'molecules/nav-link.html' as nav_link %}

      <ul class="o-secondary-navigation_list
                 o-secondary-navigation_list__parents">
      {%- for item in report_sections %}
          <li>
            {{ nav_link.render(item.numbering + item.title, "#" + item.id, true) }}
          {% if item.children %}
              <ul class="o-secondary-navigation_list
                         o-secondary-navigation_list__children">
              {%- for child in item.children -%}
                  <li>
                      {{ nav_link.render(child.title, "#" + child.id, false) }}
                  </li>
              {%- endfor %}
              </ul>
          {% endif %}
          </li>
      {%- endfor %}
      </ul>
      {% if report_appendices %}
        <h4>Appendices</h4>
      {% endif %}
      <ul class="o-secondary-navigation_list
                 o-secondary-navigation_list__parents
                 o-report-sidenav__appendix">
       {%- for item in report_appendices %}
          <li class="m-list_item">
            {{ nav_link.render(item.numbering + item.title, "#" + item.id, true) }}
          {%- if item.children -%}
              <ul class="o-secondary-navigation_list
                         o-secondary-navigation_list__children">
              {%- for child in item.children -%}
                  <li>
                      {{ nav_link.render(child.title, "#" + child.id, false) }}
                  </li>
              {%- endfor %}
              </ul>
          {%- endif -%}
          </li>
      {%- endfor %}
      </ul>
      {% endcall %}
</nav>
{% endmacro %}