{# ==========================================================================

   carousel.render()

   ==========================================================================

   Description:

   Creates markup for a Carousel organism, which displays a set of
   blocks of content that can be navigated through sequentially.

   value._items:                Carousel content panels.

   item.title:                  Panel title.

   item.body:                   Panel body text.

   item.link.text:              Panel link text.

   item.link.url:               Panel link URL.

   item.image:                  Panel Wagtail image.

   ========================================================================== #}

{% macro render_carousel_item( item ) %}
<section class="o-carousel_item">
    <div class="o-carousel_item-text">
        <h2>{{ item.title }}</h2>
        <p>{{ item.body }}</p>
        <p><a href="{{ item.link.url }}">{{ item.link.text }}</a></p>
    </div>
    <div class="o-carousel_item-visual">
        {% set image_atom = make_image_atom( item.image ) %}
        {% set image_original = image( image_atom.upload, 'original' ) %}
        <img class="o-carousel_item-img"
             src="{{ image_original.url }}"
             alt="{{ image_atom.alt }}"
        >
    </div>
</section>
{% endmacro %}

{% macro render_carousel_thumbnail( item, is_selected=false ) %}
<button class="o-carousel_thumbnail{% if is_selected %} o-carousel_thumbnail-selected{%endif%}">
    <li class="o-carousel_thumbnail-layout">
        <div class="o-carousel_thumbnail-visual">
            {% set image_atom = make_image_atom( item.image ) %}
            {% set image_thumbnail = image( image_atom.upload, 'fill-50x50' ) %}
            <img class="o-carousel_thumbnail-img"
                src="{{ image_thumbnail.url }}"
                alt="{{ image_atom.alt }}">
        </div>
        <p class="o-carousel_thumbnail-text">
            {{ item.title }}
        <p>
    </li>
</button>
{% endmacro %}

{#
    Since desktop uses a button and mobile uses links,
    we duplicate the markup here but use a div instead of a button.
#}
{% macro render_carousel_thumbnail_mobile( item, is_selected=false ) %}
<div class="o-carousel_thumbnail{% if is_selected %} o-carousel_thumbnail-selected{% endif %}">
    <li class="o-carousel_thumbnail-layout">
        <div class="o-carousel_thumbnail-visual">
            <a href="{{ item.link.url }}">
                {% set image_atom = make_image_atom( item.image ) %}
                {% set image_thumbnail = image( image_atom.upload, 'fill-50x50' ) %}
                <img class="o-carousel_thumbnail-img"
                    src="{{ image_thumbnail.url }}"
                    alt="{{ image_atom.alt }}">
            </a>
        </div>
        <p class="o-carousel_thumbnail-text">
            <a href="{{ item.link.url }}">
                {{ item.title }}
            </a>
        <p>
    </li>
</div>
{% endmacro %}

{% macro render(value) %}
<div class="o-carousel u-hidden">
    <h5>Featured</h5>
    <div class="o-carousel_navigator">

        <button class="o-carousel_btn o-carousel_btn-prev a-btn" aria-label="Previous showcase item">
            {{ svg_icon( 'left' ) }}
        </button>
        <button class="o-carousel_btn o-carousel_btn-next a-btn" aria-label="Next showcase item">
            {{ svg_icon( 'right' ) }}
        </button>

        <ul class="o-carousel_items-container">
            <div class="o-carousel_items">
                {% for item in value._items %}
                    {{ render_carousel_item( item ) }}
                {% endfor %}
            </div>
        </ul>

    </div>

    <ul class="o-carousel_thumbnails">
        {% for item in value._items %}
            {{ render_carousel_thumbnail( item, loop.first ) }}
        {% endfor %}
    </ul>

    <ul class="o-carousel_thumbnails o-carousel_thumbnails__mobile">
        {% for item in value._items %}
            {{ render_carousel_thumbnail_mobile( item, loop.first ) }}
        {% endfor %}
    </ul>
</div>
{% endmacro %}

{% if value %}{{ render( value ) }}{% endif %}
